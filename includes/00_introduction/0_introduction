<h1 id='introduction-1'><span id=introduction></span>Introduction</h1>
<p>This documentation describes Placewise&#39;s MPC APIs that allow to manage Loyalty Club, its members and content.</p>
<h2 id='hosts-1'><span id=hosts></span>Hosts</h2>
<p>Production: <a href="https://api.mpc.placewise.com">https://api.mpc.placewise.com</a></p>

<p>Production (APAC region): <a href="https://api.mpc.apac.placewise.com">https://api.mpc.apac.placewise.com</a></p>

<p>Staging: <a href="https://api.mpc.dev.placewise.com">https://api.mpc.dev.placewise.com</a></p>
<h3 id='https-tls-requirement-1'><span id=https-tls-requirement></span>HTTPS (TLS) requirement</h3>
<p>To make connection to Placewise&#39;s MPC APIs you have to use HTTPS with TLS encryption.
Your client has to support TLS1.2+ with strong ciphers.</p>
<h2 id='common-params-and-headers-1'><span id=common-params-and-headers></span>Common params and headers</h2><h3 id='quot-content-type-quot-header-1'><span id=quot-content-type-quot-header></span>&quot;content-type&quot; header</h3>
<p>This API supports <code>application/json</code> only. </p>

<p>Both payload and response body are supposed to be a valid JSON so when making a request send a <code>content-type: application/json</code> header.</p>

<p>If payload is not a valid JSON, then <code>406 Not Acceptable</code> HTTP code and empty response body are returned.</p>
<h3 id='quot-x-client-authorization-quot-header-1'><span id=quot-x-client-authorization-quot-header></span>&quot;x-client-authorization&quot; header</h3>
<blockquote>
<p>Example header: <code>x-client-authorization: B7t9U9tsoWsGhrv2ouUoSqpM</code></p>
</blockquote>

<p>All of the endpoints <strong>require</strong> a client authorization header - <code>x-client-authorization</code>.</p>

<p>It should be used only on backend and never exposed in frontend code.</p>

<p>Each token has are permits assigned to it. Depending what permits are assigned, access to some of the endpoints
may be restricted.</p>

<p>If you miss your authentication token, please <a href="https://placewise.com">let us know</a>.</p>
<h3 id='quot-x-user-agent-quot-header-1'><span id=quot-x-user-agent-quot-header></span>&quot;x-user-agent&quot; header</h3>
<blockquote>
<p>Example header: <code>x-user-agent: Infinity Mall Android App</code></p>
</blockquote>

<p><code>x-user-agent</code> is <strong>required</strong> to distinguish specific client for information and debugging purposes so we better know who uses the service.</p>

<p>It should be arbitrarily chosen to represent client specifics (e.g. &#39;Infinity Mall Android App v1.2&#39; or &#39;Infinity Mall Backend Service&#39;)</p>
<h3 id='quot-x-product-name-quot-header-1'><span id=quot-x-product-name-quot-header></span>&quot;x-product-name&quot; header</h3>
<blockquote>
<p>Example header: <code>x-product-name: android-app</code></p>
</blockquote>

<p>Each system that is communicating with us should uniquely identify itself so it is possible to distinguish optin/update channels.
That will allow further targeting members by communication channel.</p>

<p>For that we use product name. It should be passed as <strong>required</strong> header <code>x-product-name</code> that is intended to provide the necessary granularity.</p>

<p>If you miss your product name, please <a href="https://placewise.com">let us know</a>.</p>
<h3 id='quot-authorization-quot-header-1'><span id=quot-authorization-quot-header></span>&quot;authorization&quot; header</h3>
<blockquote>
<p>Example header: <code>authorization: Bearer 8433d608645345a45ce5a0f5ba1225e57546e86ac49e5fec842159dc82218522</code></p>
</blockquote>

<p>See: <a href="#oauth2">OAuth2</a></p>
<h3 id='loyalty-club-slug-param-1'><span id=loyalty-club-slug-param></span>Loyalty club slug param</h3>
<blockquote>
<p>Example slug: &#39;infinity-mall&#39;</p>
</blockquote>

<p>As all of the API endpoints work in the context of specific Loyalty Club, they&#39;re scoped within it&#39;s identifier - <code>:loyalty_club_slug</code></p>

<p>It&#39;s an unique slugified name of the Loyalty Club.</p>
<h3 id='a-name-msisdn-param-a-msisdn-param-1'><span id=a-name-msisdn-param-a-msisdn-param></span><a name="msisdn-param"></a> Msisdn param</h3>
<p>Members in our systems may be identified with their phone numbers (msisdns) according to <a href="https://en.wikipedia.org/wiki/E.164">E.164</a>
We use format without leading <code>00</code> or <code>+</code> and without spaces, so that it contains only digits, i.e. <code>4740769126</code>.</p>
<h2 id='a-name-common-http-error-codes-a-common-http-error-codes-1'><span id=a-name-common-http-error-codes-a-common-http-error-codes></span><a name="common-http-error-codes"></a> Common HTTP error codes</h2>
<table><thead>
<tr>
<th>Status</th>
<th>Reason</th>
</tr>
</thead><tbody>
<tr>
<td><code>401</code></td>
<td><code>x-client-authorization</code> is invalid (or doesn&#39;t match provided loyalty club or product)</td>
</tr>
<tr>
<td><code>402</code></td>
<td>Feature is not enabled for the Loyalty Club</td>
</tr>
<tr>
<td><code>403</code></td>
<td>Not authorized to perform this action (provided <code>x-client-authorization</code> doesn&#39;t have required permit)</td>
</tr>
<tr>
<td><code>404</code></td>
<td>The requested resource doesn&#39;t exist</td>
</tr>
<tr>
<td><code>422</code></td>
<td>Invalid parameters are provided (e.g. incorrect properties on member creation)</td>
</tr>
<tr>
<td><code>460</code></td>
<td>OAuth token required for the action is invalid (applies only to OAuth-related actions - see <a href="#oauth2">OAuth2</a>)</td>
</tr>
<tr>
<td><code>470</code></td>
<td>Some of required header is missing</td>
</tr>
<tr>
<td><code>471</code></td>
<td>Some of headers is incorrect</td>
</tr>
<tr>
<td><code>503</code></td>
<td>Server is down for maintenance</td>
</tr>
</tbody></table>

<p>Also, most of handled errors have JSON response body like this:</p>

<p><code>{&quot;error&quot;: &quot;Message describing what went wrong&quot;}</code></p>
<h2 id='a-name-pagination-model-a-pagination-json-model-1'><span id=a-name-pagination-model-a-pagination-json-model></span><a name="pagination-model"></a> Pagination JSON model</h2>
<blockquote>
<p>Example:</p>
</blockquote>
<pre class="highlight json tab-json"><code><span class="p">{</span><span class="w">
    </span><span class="s2">"total_count"</span><span class="p">:</span><span class="w"> </span><span class="mi">2050</span><span class="p">,</span><span class="w">
    </span><span class="s2">"per_page"</span><span class="p">:</span><span class="w"> </span><span class="mi">1000</span><span class="p">,</span><span class="w">
    </span><span class="s2">"total_pages"</span><span class="p">:</span><span class="w"> </span><span class="mi">3</span><span class="p">,</span><span class="w">
    </span><span class="s2">"current_page"</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w">
    </span><span class="s2">"next_page"</span><span class="p">:</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w">
    </span><span class="s2">"prev_page"</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span><span class="w">
    </span><span class="s2">"is_first_page"</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span><span class="w">
    </span><span class="s2">"is_last_page"</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span><span class="w">
    </span><span class="s2">"is_out_of_range"</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>
<p>Used to present information about paginated pages</p>

<table><thead>
<tr>
<th>Key</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>total_count</td>
<td>integer</td>
<td>Number of all available results</td>
</tr>
<tr>
<td>per_page</td>
<td>integer</td>
<td>Number of results returned per request</td>
</tr>
<tr>
<td>total_pages</td>
<td>integer</td>
<td>Number of all available pages</td>
</tr>
<tr>
<td>current_page</td>
<td>integer</td>
<td></td>
</tr>
<tr>
<td>next_page</td>
<td>integer</td>
<td>Next available page (<code>null</code> when it&#39;s a last page)</td>
</tr>
<tr>
<td>prev_page</td>
<td>integer</td>
<td>Previous available page (<code>null</code> when it&#39;s a first page)</td>
</tr>
<tr>
<td>is_first_page</td>
<td>boolean</td>
<td></td>
</tr>
<tr>
<td>is_last_page</td>
<td>boolean</td>
<td></td>
</tr>
<tr>
<td>is_out_of_range</td>
<td>boolean</td>
<td>Is given <code>per_page</code> param out of range?</td>
</tr>
</tbody></table>
<h2 id='a-name-api-entity-model-a-api-entity-json-model-1'><span id=a-name-api-entity-model-a-api-entity-json-model></span><a name="api-entity-model"></a> API Entity JSON model</h2>
<blockquote>
<p>Example - token entity:</p>
</blockquote>
<pre class="highlight json tab-json"><code><span class="p">{</span><span class="w">
    </span><span class="s2">"entity_type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"token"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"entity_id"</span><span class="p">:</span><span class="w"> </span><span class="mi">491</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>
<blockquote>
<p>Example - user entity:</p>
</blockquote>
<pre class="highlight json tab-json"><code><span class="p">{</span><span class="w">
    </span><span class="s2">"entity_type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"token"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"entity_id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"24ef9f75-90da-4bae-a5a7-b5361dda718a"</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>
<p>Used to represent API entity related to given resource.</p>

<table><thead>
<tr>
<th>Key</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>entity_type</td>
<td>enum: [&quot;token&quot;, &quot;user&quot;]</td>
<td>Type of entity</td>
</tr>
<tr>
<td>entity_id</td>
<td>misc</td>
<td>ID of entity</td>
</tr>
</tbody></table>
<h2 id='a-name-invalid-parameters-errors-model-a-invalid-parameters-errors-422-1'><span id=a-name-invalid-parameters-errors-model-a-invalid-parameters-errors-422></span><a name="invalid-parameters-errors-model"></a> Invalid parameters errors (422)</h2>
<blockquote>
<p>Example:</p>
</blockquote>
<pre class="highlight javascript"><code><span class="c1">// Considering that request with following payload has been sent:</span>
<span class="p">{</span>
  <span class="s2">"member"</span><span class="p">:</span> <span class="p">{</span>
    <span class="s2">"first_name"</span><span class="p">:</span> <span class="s2">"s"</span><span class="p">,</span>
    <span class="s2">"msisdns"</span><span class="p">:</span> <span class="p">[</span>
      <span class="s2">"123"</span><span class="p">,</span>
      <span class="s2">"4740769126"</span><span class="p">,</span>
      <span class="s2">""</span>
    <span class="p">]</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="c1">// Following response is returned: </span>
<span class="p">{</span>
  <span class="s2">"error"</span><span class="p">:</span> <span class="s2">"Invalid parameters"</span><span class="p">,</span>
  <span class="s2">"details"</span><span class="p">:</span> <span class="p">{</span>
    <span class="s2">"member"</span><span class="p">:</span> <span class="p">{</span>
      <span class="s2">"name"</span><span class="p">:</span> <span class="p">[</span>
        <span class="p">{</span>
          <span class="s2">"value"</span><span class="p">:</span> <span class="s2">"s"</span><span class="p">,</span>
          <span class="s2">"error"</span><span class="p">:</span> <span class="s2">"too_short"</span><span class="p">,</span>
          <span class="s2">"options"</span><span class="p">:</span> <span class="p">{</span>
            <span class="s2">"min_length"</span><span class="p">:</span> <span class="mi">0</span>
          <span class="p">},</span>
          <span class="s2">"message"</span><span class="p">:</span> <span class="s2">"is too short"</span>
        <span class="p">},</span>
        <span class="p">{</span>
          <span class="s2">"value"</span><span class="p">:</span> <span class="s2">"s"</span><span class="p">,</span>
          <span class="s2">"error"</span><span class="p">:</span> <span class="s2">"invalid_format"</span><span class="p">,</span>
          <span class="s2">"options"</span><span class="p">:</span> <span class="p">{</span>
            <span class="s2">"format"</span><span class="p">:</span> <span class="s2">"/[A-Z][a-z]+/"</span>
          <span class="p">},</span>
          <span class="s2">"message"</span><span class="p">:</span> <span class="s2">"has invalid format"</span>
        <span class="p">}</span>
      <span class="p">],</span>
      <span class="s2">"msisdns"</span><span class="p">:</span> <span class="p">{</span>
        <span class="s2">"0"</span><span class="p">:</span> <span class="p">[</span>
          <span class="p">{</span>
            <span class="s2">"value"</span><span class="p">:</span> <span class="s2">"32"</span><span class="p">,</span>
            <span class="s2">"error"</span><span class="p">:</span> <span class="s2">"invalid_msisdn"</span><span class="p">,</span>
            <span class="s2">"options"</span><span class="p">:</span> <span class="p">{},</span>
            <span class="s2">"message"</span><span class="p">:</span> <span class="s2">"is not a valid MSISDN"</span>
          <span class="p">}</span>
        <span class="p">],</span>
        <span class="s2">"2"</span><span class="p">:</span> <span class="p">[</span>
          <span class="p">{</span>
            <span class="s2">"value"</span><span class="p">:</span> <span class="s2">""</span><span class="p">,</span>
            <span class="s2">"error"</span><span class="p">:</span> <span class="s2">"blank"</span><span class="p">,</span>
            <span class="s2">"options"</span><span class="p">:</span> <span class="p">{},</span>
            <span class="s2">"message"</span><span class="p">:</span> <span class="s2">"cannot be blank"</span>
          <span class="p">}</span>
        <span class="p">]</span>
      <span class="p">}</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="c1">// It means that in given payload:</span>
<span class="c1">// * member.name is too short </span>
<span class="c1">// * member.name has invalid format</span>
<span class="c1">// * member.msisdns[0] is not a valid MSISDN</span>
<span class="c1">// * member.msisdns[2] is blank</span>
</code></pre>
<p>Some of the endpoints (it&#39;s noted on specific request&#39;s description) return invalid parameters errors in the standardized way.</p>

<p>For them, when some of parameter (either JSON body or URL/Query) is invalid, server responds with 422 with a following 
object:  </p>

<table><thead>
<tr>
<th>key</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>error</td>
<td>String</td>
<td>Always &quot;Invalid parameters&quot;</td>
</tr>
<tr>
<td>details</td>
<td>Errors object</td>
<td>See <a href="#errors-object">Errors</a> below</td>
</tr>
<tr>
<td>details.(path.0.to.)parameter_name</td>
<td>Array<ParameterError></td>
<td>See <a href="#parameter-error-object">ParameterError</a> below</td>
</tr>
</tbody></table>
<h4 id='a-name-errors-object-a-errors-object-1'><span id=a-name-errors-object-a-errors-object></span><a name="errors-object"></a> Errors object</h4>
<p>It&#39;s a recursive tree structure, corresponding to the structure original payload.
Objects being parts of arrays are represented by their array indexes.</p>

<p>Each leaf node is an array of <a href="#parameter-error-object">ParameterError</a> objects for given parameter.</p>
<h4 id='a-name-parameter-error-object-a-parametererror-object-1'><span id=a-name-parameter-error-object-a-parametererror-object></span><a name="parameter-error-object""></a> ParameterError object</h4>
<table><thead>
<tr>
<th>key</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>value</td>
<td>Mixed</td>
<td>Value of given parameter</td>
</tr>
<tr>
<td>error</td>
<td>String</td>
<td>Symbol of error that relates to this parameter</td>
</tr>
<tr>
<td>options</td>
<td>Object</td>
<td>Contains options of specific validation rule. For example <code>{&quot;max&quot;: 15}</code>.</td>
</tr>
<tr>
<td>message</td>
<td>String</td>
<td>Human-readable error message</td>
</tr>
</tbody></table>
<h4 id='a-name-common-validation-errors-a-common-validation-errors-1'><span id=a-name-common-validation-errors-a-common-validation-errors></span><a name="common-validation-errors"></a> Common validation errors</h4>
<table><thead>
<tr>
<th>Error key</th>
<th>Options</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>presence</td>
<td></td>
<td>When not present</td>
</tr>
<tr>
<td>inclusion</td>
<td><code>in</code> - contains permitted values</td>
<td>When doesn&#39;t match list of permitted values</td>
</tr>
<tr>
<td>must_be_an_object</td>
<td></td>
<td></td>
</tr>
<tr>
<td>must_be_an_array</td>
<td></td>
<td></td>
</tr>
<tr>
<td>must_be_an_array_of_objects</td>
<td></td>
<td></td>
</tr>
<tr>
<td>must_have_elements_of_type</td>
<td><code>type</code> - required type</td>
<td></td>
</tr>
<tr>
<td>not_an_integer</td>
<td></td>
<td></td>
</tr>
<tr>
<td>invalid_msisdn</td>
<td></td>
<td>When cannot be processed as a valid <a href="#msisdn-param">MSISDN</a></td>
</tr>
<tr>
<td>invalid_email</td>
<td></td>
<td></td>
</tr>
<tr>
<td>invalid_iso_8601_time</td>
<td></td>
<td>When not valid according to <a href="#https://en.wikipedia.org/wiki/ISO_8601">ISO 8601</a></td>
</tr>
<tr>
<td>attribute_cannot_be_present_with</td>
<td><code>with</code> - other attribute name</td>
<td>Mutually exclusive with another attribute</td>
</tr>
<tr>
<td>size_too_small</td>
<td><code>number</code> - min size</td>
<td>When array has not enough elements</td>
</tr>
<tr>
<td>size_too_large</td>
<td><code>number</code> - max size</td>
<td>When array has too many elements</td>
</tr>
<tr>
<td>size_not_match</td>
<td><code>number</code> - exact size</td>
<td>When array has not exactly required number of elements</td>
</tr>
<tr>
<td>taken</td>
<td></td>
<td>When another record already uses this value</td>
</tr>
<tr>
<td>not_a_number</td>
<td></td>
<td></td>
</tr>
<tr>
<td>greater_than</td>
<td><code>number</code> - min value</td>
<td>When not &gt; <code>number</code></td>
</tr>
<tr>
<td>greater_or_equal_to</td>
<td><code>number</code> - min value</td>
<td>When not &gt;= <code>number</code></td>
</tr>
<tr>
<td>less_than</td>
<td><code>number</code> - max value</td>
<td>When not &lt; <code>number</code></td>
</tr>
<tr>
<td>less_or_equal_to</td>
<td><code>number</code> - max value</td>
<td>When not &lt;= <code>number</code></td>
</tr>
<tr>
<td>invalid</td>
<td><code>format</code> - regex</td>
<td>When does not match regex</td>
</tr>
<tr>
<td>liquid_syntax_error</td>
<td><code>syntax_error</code> - error description</td>
<td>When not valid <a href="https://shopify.github.io/liquid/">liquid</a> syntax</td>
</tr>
<tr>
<td>must_be_in_the_future</td>
<td></td>
<td>When date is not in the future</td>
</tr>
<tr>
<td>must_be_in_the_past</td>
<td></td>
<td>When date is not in the past</td>
</tr>
</tbody></table>
