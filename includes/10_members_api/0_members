<h1 id='members-api-1'><span id=members-api></span>Members API</h1><h2 id='members-1'><span id=members></span>Members</h2><h3 id='introduction-1'><span id=introduction></span>Introduction</h3><h4 id='authentication-1'><span id=authentication></span>Authentication</h4>
<p>Actions related to specific member (the one that is using your application) require to have member authenticated and we implement
OAuth2 flow for this.</p>

<p>See <a href="#oauth2">Members OAuth</a> to see how to authenticate the member with OAuth2.</p>
<h4 id='a-name-member-model-a-member-model-1'><span id=a-name-member-model-a-member-model></span><a name="member-model"></a> Member model</h4>
<blockquote>
<p>Example:</p>
</blockquote>
<pre class="highlight json tab-json"><code><span class="p">{</span><span class="w">
  </span><span class="s2">"id"</span><span class="p">:</span><span class="w"> </span><span class="mi">42</span><span class="p">,</span><span class="w">
  </span><span class="s2">"properties"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="s2">"first_name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Ola"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"last_name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Nordmann"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"birthday"</span><span class="p">:</span><span class="w"> </span><span class="s2">"1990-10-23"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"interests"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
      </span><span class="s2">"bikes_and_cars"</span><span class="p">,</span><span class="w">
      </span><span class="s2">"sportwear"</span><span class="w">
    </span><span class="p">],</span><span class="w">
    </span><span class="s2">"child_birth_years"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
      </span><span class="mi">2010</span><span class="p">,</span><span class="w">
      </span><span class="mi">2011</span><span class="p">,</span><span class="w">
      </span><span class="mi">2011</span><span class="w">
    </span><span class="p">],</span><span class="w">
    </span><span class="s2">"language"</span><span class="p">:</span><span class="w"> </span><span class="s2">"no"</span><span class="w">
  </span><span class="p">},</span><span class="w">
  </span><span class="s2">"consents"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="s2">"consent1"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="s2">"status"</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span><span class="w"> </span><span class="s2">"updated_at"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2018-12-14T21:57:20.063Z"</span><span class="w"> </span><span class="p">},</span><span class="w">
    </span><span class="s2">"consent2"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="s2">"status"</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span><span class="w"> </span><span class="s2">"updated_at"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2018-10-25T21:57:43.738Z"</span><span class="w"> </span><span class="p">}</span><span class="w">
  </span><span class="p">},</span><span class="w">
  </span><span class="s2">"sms_status"</span><span class="p">:</span><span class="w"> </span><span class="s2">"enabled"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"email_status"</span><span class="p">:</span><span class="w"> </span><span class="s2">"hard_bounced"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"push_status"</span><span class="p">:</span><span class="w"> </span><span class="s2">"disabled"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"optin_channel"</span><span class="p">:</span><span class="w"> </span><span class="s2">"webforms"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"optin_subchannel"</span><span class="p">:</span><span class="w"> </span><span class="s2">"campaign-10-2017"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"created_at"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2017-01-19T10:07:08.336+01:00"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"updated_at"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2017-04-03T09:35:19.313+02:00"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"banned_until"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2137-04-03T09:35:19.313+02:00"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"person_id"</span><span class="p">:</span><span class="w"> </span><span class="mi">99</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>
<p>Standard member JSON model returned from many API endpoints.</p>

<table><thead>
<tr>
<th>Key</th>
<th>Description</th>
<th>Type</th>
</tr>
</thead><tbody>
<tr>
<td>id</td>
<td>Member ID</td>
<td>integer</td>
</tr>
<tr>
<td>properties</td>
<td>Object with member&#39;s properties</td>
<td>JSON Object</td>
</tr>
<tr>
<td>properties[&#39;language&#39;]</td>
<td>Language used by user</td>
<td>string</td>
</tr>
<tr>
<td>consents</td>
<td>Member&#39;s consents JSON model (see below)</td>
<td>JSON Object</td>
</tr>
<tr>
<td>sms_status</td>
<td>Status of sms channel</td>
<td>string</td>
</tr>
<tr>
<td>email_status</td>
<td>Status of email channel</td>
<td>string</td>
</tr>
<tr>
<td>push_status</td>
<td>Status of push channel</td>
<td>string</td>
</tr>
<tr>
<td>optin_channel</td>
<td>Channel (<code>x-product-name</code> header) which had been used to register member</td>
<td>string</td>
</tr>
<tr>
<td>optin_subchannel</td>
<td>Subchannel (<code>X-Subproduct-Name</code> header) which had been used to register member</td>
<td>string</td>
</tr>
<tr>
<td>created_at</td>
<td>Time when the user was firstly created</td>
<td>string</td>
</tr>
<tr>
<td>updated_at</td>
<td>Time when the user was last updated</td>
<td>string</td>
</tr>
<tr>
<td>banned_until</td>
<td>Time since member was/is banned (not updatable through OAuth)</td>
<td>string</td>
</tr>
<tr>
<td>person_id</td>
<td>Unique Member&#39;s identifier (set internally)</td>
<td>string</td>
</tr>
</tbody></table>
<h4 id='a-name-member-consents-model-a-member-39-s-consents-json-model-1'><span id=a-name-member-consents-model-a-member-39-s-consents-json-model></span><a name="member-consents-model"></a> Member&#39;s consents JSON model</h4>
<p>JSON model for consents. Keys can be dynamically created based on customer&#39;s need.</p>

<p>It consists of: <code>&#39;consent-slug&#39;: { &quot;status&quot;: &lt;boolean_value&gt;, &quot;updated_at&quot;: &lt;time&gt; }</code></p>

<ul>
<li>If status is <code>true</code> - Member approved consent.</li>
<li>If status is <code>false</code> - Member disapproved consent.</li>
<li>If you can&#39;t find slug on Member: he/she haven&#39;t disapproved or approved consent.</li>
</ul>

<p><code>updated_at</code> is the time of last consent update. It can be also not provided or null.</p>

<p>Available consents for Loyalty Club are described in <a href="#loyalty-clubs-schema">schema</a>.</p>
<h4 id='validation-on-members-1'><span id=validation-on-members></span>Validation on members</h4>
<p>All members&#39; endpoints have properties validation. Properties are validated to conform loyalty club&#39;s schema.</p>

<p>If something is wrong, you will receive explanation of errors in response.</p>
<h5 id='schema-validation-errors-1'><span id=schema-validation-errors></span>Schema validation errors</h5><pre class="highlight shell tab-shell"><code>curl -X PUT -H <span class="s2">"x-product-name: custom-product-name"</span> <span class="se">\</span>
    -H <span class="s2">"X-Customer-Private-Token: token"</span> <span class="se">\</span>
    -H <span class="s2">"content-type: application/json"</span> -d <span class="s1">'{
    "properties": {
        "first_name": "",
        "last_name": "err",
        "gender": "man",
        "birthday": "201X-01-01"
    }
}'</span> <span class="s2">"https://tbp.bstcm.no/api/v2/loyalty_clubs/:loyalty_club_slug/members/:msisdn"</span>
</code></pre>
<blockquote>
<p>Example response (with code 400):</p>
</blockquote>
<pre class="highlight json tab-json"><code><span class="p">{</span><span class="w">
  </span><span class="s2">"email"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
    </span><span class="p">{</span><span class="w">
      </span><span class="s2">"error"</span><span class="p">:</span><span class="w"> </span><span class="s2">"invalid"</span><span class="p">,</span><span class="w">
      </span><span class="s2">"property"</span><span class="p">:</span><span class="w"> </span><span class="s2">"email"</span><span class="w">
    </span><span class="p">}</span><span class="w">
  </span><span class="p">],</span><span class="w">
  </span><span class="s2">"properties"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
    </span><span class="p">{</span><span class="w">
      </span><span class="s2">"error"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="s2">"language"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
          </span><span class="p">{</span><span class="w">
            </span><span class="s2">"error"</span><span class="p">:</span><span class="w"> </span><span class="s2">"value_not_match"</span><span class="p">,</span><span class="w">
            </span><span class="s2">"value"</span><span class="p">:</span><span class="w"> </span><span class="s2">"een"</span><span class="p">,</span><span class="w">
            </span><span class="s2">"values"</span><span class="p">:</span><span class="w"> </span><span class="s2">"en, no"</span><span class="p">,</span><span class="w">
            </span><span class="s2">"property"</span><span class="p">:</span><span class="w"> </span><span class="s2">"language"</span><span class="w">
          </span><span class="p">}</span><span class="w">
        </span><span class="p">],</span><span class="w">
        </span><span class="s2">"optin_channel"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
          </span><span class="p">{</span><span class="w">
            </span><span class="s2">"error"</span><span class="p">:</span><span class="w"> </span><span class="s2">"not_contain_required_property"</span><span class="p">,</span><span class="w">
            </span><span class="s2">"property"</span><span class="p">:</span><span class="w"> </span><span class="s2">"optin_channel"</span><span class="w">
          </span><span class="p">}</span><span class="w">
        </span><span class="p">]</span><span class="w">
      </span><span class="p">}</span><span class="w">
    </span><span class="p">}</span><span class="w">
  </span><span class="p">]</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>
<table><thead>
<tr>
<th>Error</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>invalid_date_format</td>
<td>Invalid date format</td>
</tr>
<tr>
<td>invalid_time_format</td>
<td>Invalid time format</td>
</tr>
<tr>
<td>invalid_date_time_format</td>
<td>Invalid date with time format</td>
</tr>
<tr>
<td>must_be_valid_RFC3339_date_time_string</td>
<td>Format beyond the RFC3339 standard</td>
</tr>
<tr>
<td>invalid_URI</td>
<td>Invalid URI</td>
</tr>
<tr>
<td>additional_array_elements</td>
<td>Additional elements in the array</td>
</tr>
<tr>
<td>additional_properties</td>
<td>Additional properties</td>
</tr>
<tr>
<td>property_not_match_all_of</td>
<td>The property did not match all of the required schemas</td>
</tr>
<tr>
<td>property_not_match_any_of</td>
<td>The property did not match any of the required schema</td>
</tr>
<tr>
<td>property_matched_more_than_one</td>
<td>The property matched more than one of the required schemas</td>
</tr>
<tr>
<td>depends_on_a_missing_property</td>
<td>The validated property has a property that depends on the other missing property</td>
</tr>
<tr>
<td>value_not_match</td>
<td>The property value did not match one of the given values.</td>
</tr>
<tr>
<td>schema_cannot_be_found</td>
<td>The extended schema cannot be found</td>
</tr>
<tr>
<td>not_a_valid_schema</td>
<td>The property was not a valid schema</td>
</tr>
<tr>
<td>minimum_string_length</td>
<td>The property was not of a minimum string length of minimum limit.</td>
</tr>
<tr>
<td>maximum_string_length</td>
<td>The property was not of a maximum string length of maximum limit.</td>
</tr>
<tr>
<td>less_item_than_minimum</td>
<td>The property did not contain a minimum number of minimum items limit</td>
</tr>
<tr>
<td>more_item_than_maximum</td>
<td>The property had more items than the allowed items limit</td>
</tr>
<tr>
<td>less_properties_than_minimum</td>
<td>The property did not contain a minimum number of properties</td>
</tr>
<tr>
<td>more_properties_than_maximum</td>
<td>The property had more properties than allowed</td>
</tr>
<tr>
<td>not_have_value_of_exclusively</td>
<td>The property did not have value of exclusively</td>
</tr>
<tr>
<td>not_have_value_of_inclusively</td>
<td>The property did not have value of inclusively</td>
</tr>
<tr>
<td>more_decimal_places_than_maximum</td>
<td>The property had more decimal places than the allowed maximum</td>
</tr>
<tr>
<td>matched_the_disallowed_schema</td>
<td>The property matched the disallowed schema</td>
</tr>
<tr>
<td>the_regex_not_match</td>
<td>The property did not match the regex</td>
</tr>
<tr>
<td>not_contain_required_property</td>
<td>The validated property did not contain a required property</td>
</tr>
<tr>
<td>contained_undefined_properties</td>
<td>The validated property contained undefined properties</td>
</tr>
<tr>
<td>referenced_schema_cannot_be_found</td>
<td>The referenced schema cannot be found</td>
</tr>
<tr>
<td>invalid_schema</td>
<td>The property was not a valid schema</td>
</tr>
<tr>
<td>matched_one_or_more_types</td>
<td>The property matched one or more of the given types</td>
</tr>
<tr>
<td>one_or_more_types_not_match</td>
<td>The property did not match one or more of the given types</td>
</tr>
<tr>
<td>type_not_match</td>
<td>The property did not match the given type</td>
</tr>
<tr>
<td>contained_duplicated_array_values</td>
<td>The property contained duplicated array values</td>
</tr>
<tr>
<td>invalid_email</td>
<td>Invalid email format</td>
</tr>
<tr>
<td>invalid_mx</td>
<td>Invalid (inaccessible) email domain</td>
</tr>
<tr>
<td>disposable_email</td>
<td>The email was <a href="https://github.com/lisinge/valid_email2/blob/master/vendor/disposable_emails.yml">disposable</a></td>
</tr>
<tr>
<td>duplicated_email</td>
<td>The email was duplicated in community</td>
</tr>
</tbody></table>
<h3 id='a-name-members-index-a-list-1'><span id=a-name-members-index-a-list></span><a name="members-index"></a> List</h3>
<blockquote>
<p>Example:</p>
</blockquote>
<pre class="highlight shell tab-shell"><code>curl <span class="s2">"https://api.mpc.placewise.com/v3/infinity-mall/members?per_page=100&amp;page_no=1&amp;ids[]=1&amp;ids[]=2"</span> <span class="se">\</span>
  -H <span class="s1">'content-type: application/json'</span> <span class="se">\</span>
  -H <span class="s1">'x-client-authorization: B7t9U9tsoWsGhrv2ouUoSqpM'</span> <span class="se">\</span>
  -H <span class="s1">'x-product-name: default'</span> <span class="se">\</span>
  -H <span class="s1">'x-user-agent: CURL manual test'</span>
</code></pre>
<blockquote>
<p>Returns object containing <a href="#member-model">members</a> and <a href="#pagination-model">pagination_info</a></p>
</blockquote>
<pre class="highlight json tab-json"><code><span class="p">{</span><span class="w">
  </span><span class="s2">"members"</span><span class="p">:</span><span class="w"> </span><span class="p">[],</span><span class="w"> </span><span class="err">//</span><span class="w"> </span><span class="err">List</span><span class="w"> </span><span class="err">of</span><span class="w"> </span><span class="err">members</span><span class="w"> </span><span class="err">-</span><span class="w"> </span><span class="err">see</span><span class="w"> </span><span class="err">'Member</span><span class="w"> </span><span class="err">model'</span><span class="w">
  </span><span class="s2">"pagination_info"</span><span class="p">:</span><span class="w"> </span><span class="p">{}</span><span class="w"> </span><span class="err">//</span><span class="w"> </span><span class="err">Pagination</span><span class="w"> </span><span class="err">info</span><span class="w"> </span><span class="err">-</span><span class="w"> </span><span class="err">see</span><span class="w"> </span><span class="err">'Pagination</span><span class="w"> </span><span class="err">info</span><span class="s2">"
}

</span></code></pre>
<p><strong>GET</strong> <code>v3/:loyalty_club_slug/members?per_page=:per_page&amp;page_no=:page_no</code></p>

<p>Returns paginated list of all Loyalty Club members, sorted by <code>created_at ASC</code>.</p>

<p>Every returned member is represented by <a href="#member-model">Member model</a>.</p>
<h4 id='query-parameters-1'><span id=query-parameters></span>Query Parameters</h4>
<table><thead>
<tr>
<th>Parameter</th>
<th>Type</th>
<th>Required?</th>
<th>Default</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>per_page</td>
<td>integer</td>
<td>no</td>
<td>1000</td>
<td>Number of results to be returned per request (1000 is the maximum)</td>
</tr>
<tr>
<td>page_no</td>
<td>integer</td>
<td>no</td>
<td>1</td>
<td>Number of results page</td>
</tr>
<tr>
<td>ids</td>
<td>Array<integer></td>
<td>no</td>
<td>null</td>
<td>IDs of members that will be returned</td>
</tr>
<tr>
<td>properties[:property_name]</td>
<td>Array<any></td>
<td>no</td>
<td>null</td>
<td>Properties of members that will be returned. A property must be enabled for querying in the Loyalty Club configuration before it can be used here. Please contact us if you need this feature.</td>
</tr>
</tbody></table>
<h4 id='response-json-object-1'><span id=response-json-object></span>Response (JSON object)</h4>
<table><thead>
<tr>
<th>Key</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>members</td>
<td>Array<Member></td>
<td>Array of <a href="#member-model">Members</a></td>
</tr>
<tr>
<td>pagination_info</td>
<td>Object</td>
<td><a href="#pagination-model">Pagination</a> object</td>
</tr>
</tbody></table>
<h4 id='error-responses-1'><span id=error-responses></span>Error responses</h4>
<table><thead>
<tr>
<th>Status</th>
<th>Reason</th>
</tr>
</thead><tbody>
<tr>
<td><code>422</code></td>
<td>:per_page param exceeds the limit</td>
</tr>
</tbody></table>
<h4 id='example-queries-1'><span id=example-queries></span>Example queries</h4>
<ul>
<li><code>/members?properties[gender]=man&amp;properties[language][]=en&amp;properties[language][]=pl</code> - returns members with <code>gender=&quot;man&quot; AND language IN (&quot;en&quot;, &quot;pl&quot;)</code></li>
<li><code>/members?ids[]=1&amp;ids[]=2</code> - returns members with <code>id IN (1, 2)</code></li>
</ul>

<aside class="notice">
Requires <code>BL:Api:Members:Index</code> permit
</aside>
<h3 id='a-name-members-get-a-get-1'><span id=a-name-members-get-a-get></span><a name="members-get"></a> Get</h3>
<blockquote>
<p>Example:</p>
</blockquote>
<pre class="highlight shell tab-shell"><code>curl <span class="s2">"https://api.mpc.placewise.com/v3/infinity-mall/members/:id"</span> <span class="se">\</span>
  -H <span class="s1">'content-type: application/json'</span> <span class="se">\</span>
  -H <span class="s1">'x-client-authorization: B7t9U9tsoWsGhrv2ouUoSqpM'</span> <span class="se">\</span>
  -H <span class="s1">'x-product-name: default'</span> <span class="se">\</span>
  -H <span class="s1">'x-user-agent: CURL manual test'</span>
</code></pre>
<blockquote>
<p>When successful, returns member object as depicted <a href="#member-model">here</a></p>
</blockquote>

<p><strong>GET</strong> <code>v3/:loyalty_club_slug/members/:id</code></p>

<aside class="notice">
Requires <code>BL:Api:Members:Get</code> permit
</aside>

<p><strong>GET</strong> <code>v3/:loyalty_club_slug/members/by_msisdn/:msisdn</code></p>

<aside class="notice">
Requires <code>BL:Api:Members:Get</code> permit
</aside>

<p><strong>GET</strong> <code>v3/:loyalty_club_slug/members/by_email/:email</code></p>

<aside class="notice">
Requires <code>BL:Api:Members:Get</code> permit
</aside>

<p><strong>GET</strong> <code>v3/:loyalty_club_slug/members/me</code></p>

<aside class="notice">
Requires <code>BL:Api:Members:OAuth:Get</code> permit
</aside>
<h4 id='url-parameters-1'><span id=url-parameters></span>URL Parameters</h4>
<table><thead>
<tr>
<th>Parameter</th>
<th>Description</th>
<th>Type</th>
</tr>
</thead><tbody>
<tr>
<td>id</td>
<td>Member&#39;s ID</td>
<td>integer</td>
</tr>
<tr>
<td>msisdn</td>
<td>Member&#39;s msisdn</td>
<td>string (format as defined <a href="#msisdn-param">here</a> - example: <code>4740769126</code>)</td>
</tr>
<tr>
<td>email</td>
<td>Member&#39;s email</td>
<td>string (email)</td>
</tr>
</tbody></table>
<h4 id='response-json-object-1'><span id=response-json-object></span>Response (JSON object)</h4>
<p>See: <a href="#member-model">Member model</a></p>
<h5 id='error-responses-1'><span id=error-responses></span>Error responses</h5>
<table><thead>
<tr>
<th>Status</th>
<th>Reason</th>
</tr>
</thead><tbody>
<tr>
<td><code>404</code></td>
<td>Member with given identifier could not found</td>
</tr>
<tr>
<td><code>422</code></td>
<td>Invalid MSISDN param</td>
</tr>
</tbody></table>
<h3 id='a-name-members-public-info-a-get-public-info-1'><span id=a-name-members-public-info-a-get-public-info></span><a name="members-public-info"></a> Get public info</h3>
<blockquote>
<p>Example:</p>
</blockquote>
<pre class="highlight shell tab-shell"><code>curl <span class="s2">"https://api.mpc.placewise.com/v3/infinity-mall/members/:id/public_info"</span> <span class="se">\</span>
  -H <span class="s1">'content-type: application/json'</span> <span class="se">\</span>
  -H <span class="s1">'x-client-authorization: B7t9U9tsoWsGhrv2ouUoSqpM'</span> <span class="se">\</span>
  -H <span class="s1">'x-product-name: default'</span> <span class="se">\</span>
  -H <span class="s1">'x-user-agent: CURL manual test'</span>
</code></pre>
<blockquote>
<p>Returns hash structured like this:</p>
</blockquote>
<pre class="highlight json tab-json"><code><span class="p">{</span><span class="w">
  </span><span class="s2">"exists"</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span><span class="w"> 
  </span><span class="s2">"can_login"</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span><span class="w"> </span><span class="err">//</span><span class="w"> </span><span class="err">deprecated</span><span class="w">
  </span><span class="s2">"available_identifiers"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="s2">"email"</span><span class="p">],</span><span class="w">
  </span><span class="s2">"has_password"</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>
<p><strong>GET</strong> <code>v3/:loyalty_club_slug/members/:id/public_info</code></p>

<p><strong>GET</strong> <code>v3/:loyalty_club_slug/members/by_msisdn/:msisdn/public_info</code></p>

<p><strong>GET</strong> <code>v3/:loyalty_club_slug/members/by_email/:email/public_info</code></p>

<p>Returns basic info for given member. If member does not exist, returns `null&#39;.</p>
<h4 id='url-parameters-1'><span id=url-parameters></span>URL Parameters</h4>
<table><thead>
<tr>
<th>Parameter</th>
<th>Description</th>
<th>Type</th>
</tr>
</thead><tbody>
<tr>
<td>id</td>
<td>Member&#39;s ID</td>
<td>integer</td>
</tr>
<tr>
<td>msisdn</td>
<td>Member&#39;s msisdn</td>
<td>string (format as defined <a href="#msisdn-param">here</a> - example: <code>4740769126</code>)</td>
</tr>
<tr>
<td>email</td>
<td>Member&#39;s email</td>
<td>string (email)</td>
</tr>
</tbody></table>
<h4 id='response-json-object-1'><span id=response-json-object></span>Response (JSON object)</h4>
<table><thead>
<tr>
<th>Key</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>exists</td>
<td>boolean</td>
<td>Does member with given identifier exist in given Loyalty Club?</td>
</tr>
<tr>
<td>can_login</td>
<td>boolean</td>
<td>Is this member able to sign? (deprecated)</td>
</tr>
<tr>
<td>available_identifiers</td>
<td>string[]</td>
<td>Identifiers that are set on member</td>
</tr>
<tr>
<td>has_password</td>
<td>boolean</td>
<td>Was password set by member?</td>
</tr>
</tbody></table>

<aside class="notice">
Requires <code>BL:Api:Members:Check</code> permit
</aside>
<h4 id='error-responses-1'><span id=error-responses></span>Error responses</h4>
<table><thead>
<tr>
<th>Status</th>
<th>Reason</th>
</tr>
</thead><tbody>
<tr>
<td><code>422</code></td>
<td>Invalid MSISDN param</td>
</tr>
</tbody></table>

<!--- ############################################################################################################# --->
<h3 id='a-name-members-person-id-a-get-person-id-1'><span id=a-name-members-person-id-a-get-person-id></span><a name="members-person-id"></a> Get person id</h3>
<blockquote>
<p>Example:</p>
</blockquote>
<pre class="highlight shell tab-shell"><code>curl <span class="s2">"https://api.mpc.placewise.com/v3/infinity-mall/members/:id/person_id"</span> <span class="se">\</span>
  -H <span class="s1">'content-type: application/json'</span> <span class="se">\</span>
  -H <span class="s1">'x-client-authorization: B7t9U9tsoWsGhrv2ouUoSqpM'</span> <span class="se">\</span>
  -H <span class="s1">'x-product-name: default'</span> <span class="se">\</span>
  -H <span class="s1">'x-user-agent: CURL manual test'</span>
</code></pre>
<blockquote>
<p>Returns hash structured like this:</p>
</blockquote>
<pre class="highlight json tab-json"><code><span class="p">{</span><span class="w">
  </span><span class="s2">"source"</span><span class="p">:</span><span class="w"> </span><span class="s2">"storage"</span><span class="p">,</span><span class="w"> 
  </span><span class="s2">"person_id"</span><span class="p">:</span><span class="w"> </span><span class="mi">92</span><span class="w"> 
</span><span class="p">}</span><span class="w">
</span></code></pre>
<p><strong>GET</strong> <code>v3/:loyalty_club_slug/members/:id/person_id</code></p>

<p><strong>GET</strong> <code>v3/:loyalty_club_slug/members/by_msisdn/:msisdn/person_id</code></p>

<p><strong>GET</strong> <code>v3/:loyalty_club_slug/members/by_email/:email/person_id</code></p>

<p>Returns <code>person_id</code> for given member. Please note that <code>person_id</code> cannot be preset in member payload and will be silently ignored. Also, it cannot be updated.</p>

<blockquote>
<p>There are 4 possible successful responses:</p>

<p>If member currently exists in database:</p>
</blockquote>
<pre class="highlight json tab-json"><code><span class="p">{</span><span class="w">
  </span><span class="s2">"success"</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span><span class="w">
  </span><span class="s2">"source"</span><span class="p">:</span><span class="w"> </span><span class="s2">"db"</span><span class="p">,</span><span class="w"> 
  </span><span class="s2">"person_id"</span><span class="p">:</span><span class="w"> </span><span class="mi">92</span><span class="w"> 
</span><span class="p">}</span><span class="w">
</span></code></pre>
<blockquote>
<p>If member does not exist but was deleted in last 30 days:</p>
</blockquote>
<pre class="highlight json tab-json"><code><span class="p">{</span><span class="w">
  </span><span class="s2">"success"</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span><span class="w">
  </span><span class="s2">"source"</span><span class="p">:</span><span class="w"> </span><span class="s2">"storage"</span><span class="p">,</span><span class="w"> 
  </span><span class="s2">"person_id"</span><span class="p">:</span><span class="w"> </span><span class="mi">92</span><span class="w"> 
</span><span class="p">}</span><span class="w">
</span></code></pre>
<blockquote>
<p>If member had existed, was deleted (in last 30 days) and was created again so it exists now:</p>
</blockquote>
<pre class="highlight json tab-json"><code><span class="p">{</span><span class="w">
  </span><span class="s2">"success"</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span><span class="w">
  </span><span class="s2">"source"</span><span class="p">:</span><span class="w"> </span><span class="s2">"db_and_cache"</span><span class="p">,</span><span class="w"> 
  </span><span class="s2">"person_id"</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="w"> 
</span><span class="p">}</span><span class="w">
</span></code></pre>
<blockquote>
<p>If member does not exist and never existed or did not exist in last 30 days:</p>
</blockquote>
<pre class="highlight json tab-json"><code><span class="p">{</span><span class="w">
  </span><span class="s2">"success"</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span><span class="w">
  </span><span class="s2">"source"</span><span class="p">:</span><span class="w"> </span><span class="s2">"not_found"</span><span class="p">,</span><span class="w"> 
  </span><span class="s2">"person_id"</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="w"> 
</span><span class="p">}</span><span class="w">
</span></code></pre><h4 id='url-parameters-1'><span id=url-parameters></span>URL Parameters</h4>
<table><thead>
<tr>
<th>Parameter</th>
<th>Description</th>
<th>Type</th>
</tr>
</thead><tbody>
<tr>
<td>id</td>
<td>Member&#39;s ID</td>
<td>integer</td>
</tr>
<tr>
<td>msisdn</td>
<td>Member&#39;s msisdn</td>
<td>string (format as defined <a href="#msisdn-param">here</a> - example: <code>4740769126</code>)</td>
</tr>
<tr>
<td>email</td>
<td>Member&#39;s email</td>
<td>string (email)</td>
</tr>
</tbody></table>
<h4 id='response-json-object-1'><span id=response-json-object></span>Response (JSON object)</h4>
<table><thead>
<tr>
<th>Key</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>success</td>
<td>boolean</td>
<td>If query was successful?</td>
</tr>
<tr>
<td>source</td>
<td>string</td>
<td>Source of <code>person_id</code> (possible values are: <code>not_found</code>, <code>db</code>, <code>storage</code>)</td>
</tr>
<tr>
<td>person_id</td>
<td>integer</td>
<td>Member&#39;s <code>person_id</code></td>
</tr>
</tbody></table>

<aside class="notice">
Requires <code>BL:Api:Members:Check</code> permit
</aside>
<h4 id='error-responses-1'><span id=error-responses></span>Error responses</h4>
<table><thead>
<tr>
<th>Status</th>
<th>Reason</th>
</tr>
</thead><tbody>
<tr>
<td><code>422</code></td>
<td>Invalid MSISDN param</td>
</tr>
</tbody></table>

<!--- ############################################################################################################# --->
<h3 id='a-name-members-create-a-create-1'><span id=a-name-members-create-a-create></span><a name="members-create"></a> Create</h3>
<blockquote>
<p>Example:</p>
</blockquote>
<pre class="highlight shell tab-shell"><code>
curl -X POST <span class="se">\</span>
  https://api.mpc.placewise.com/v3/infinity-mall/members <span class="se">\</span>
  -H <span class="s1">'content-type: application/json'</span> <span class="se">\</span>
  -H <span class="s1">'x-client-authorization: B7t9U9tsoWsGhrv2ouUoSqpM'</span> <span class="se">\</span>
  -H <span class="s1">'x-product-name: facebook'</span> <span class="se">\</span>
  -H <span class="s1">'X-Subproduct-Name: campaign-10-2017'</span> <span class="se">\</span>
  -H <span class="s1">'x-user-agent: CURL manual test'</span> <span class="se">\</span>
  -d <span class="s1">'{
    "properties": {
        "email": "dev+6@example.com",
        "msisdn": "4740769126",
        "first_name": "The",
        "last_name": "Doge"
    },
    "consents": {
        "consent1": { "status": true },
        "consent2": { "status": false }
    },
    "send_sms_welcome_message": false
}'</span>

</code></pre>
<blockquote>
<p>When successful, the above command returns created member object as depicted <a href="#member-model">here</a></p>

<p>When payload is invalid, validation errors like this are returned:</p>
</blockquote>
<pre class="highlight json tab-json"><code><span class="p">{</span><span class="w">
    </span><span class="s2">"email"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
        </span><span class="p">{</span><span class="w">

            </span><span class="s2">"property"</span><span class="p">:</span><span class="w"> </span><span class="s2">"email"</span><span class="p">,</span><span class="w">
            </span><span class="s2">"error"</span><span class="p">:</span><span class="w"> </span><span class="s2">"duplicated_email_in_community"</span><span class="w">
        </span><span class="p">}</span><span class="w">
    </span><span class="p">]</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>
<p><strong>POST</strong> <code>v3/:loyalty_club_slug/members</code></p>

<p>Create member with given properties.</p>

<p>Available properties and their validation rules are defined by Loyalty Club schema (see: <a href="#loyalty-clubs-schema">here</a>).</p>

<p>Actual welcome messages sending depends on Loyalty Club and Product configuration.
For example, even if send_email_welcome_message:true param is provided, message may not be sent because either Product 
or Loyalty has disabled welcome messages or Loyalty Club has no e-mails configured at all.</p>

<p>There is also a possibility to have multiple SMS welcome messages sent. The one that matches Product or default one will be sent.</p>
<h4 id='a-name-members-create-registration-password-a-registration-password-1'><span id=a-name-members-create-registration-password-a-registration-password></span><a name="members-create-registration-password"></a> Registration Password</h4>
<p>Some API clients (depends on Permit assigned to given <code>x-client-authorization</code> token) may be required to provide 
valid <code>registration_password</code> param that is sent to user with <a href="#members-send-registration-password">Members &gt; Send registration password</a> </p>
<h4 id='headers-1'><span id=headers></span>Headers</h4>
<table><thead>
<tr>
<th>Header name</th>
<th>Required?</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>X-Subproduct-Name</td>
<td>no</td>
<td>Additional source/optin channel information</td>
</tr>
</tbody></table>
<h4 id='a-name-members-create-post-parameters-a-post-parameters-json-1'><span id=a-name-members-create-post-parameters-a-post-parameters-json></span><a name="members-create-post-parameters"></a> POST Parameters (JSON)</h4>
<table><thead>
<tr>
<th>Parameter</th>
<th>Required?</th>
<th>Default</th>
<th>Description</th>
<th>Type</th>
</tr>
</thead><tbody>
<tr>
<td>properties</td>
<td><strong>yes</strong></td>
<td>none</td>
<td>JSON with properties for member</td>
<td>JSON Object</td>
</tr>
<tr>
<td>properties[&#39;language&#39;]</td>
<td>no</td>
<td>&quot;default_language&quot; from schema</td>
<td>Language used by user</td>
<td>string</td>
</tr>
<tr>
<td>properties[&#39;msisdn&#39;]</td>
<td>yes*</td>
<td>none</td>
<td>Unique member&#39;s msisdn as defined <a href="#msisdn-param">here</a>) Example: <code>4740769126</code>.</td>
<td>string</td>
</tr>
<tr>
<td>properties[&#39;email&#39;]</td>
<td>yes*</td>
<td>none</td>
<td>Member&#39;s email</td>
<td>string</td>
</tr>
<tr>
<td>consents</td>
<td>no</td>
<td>{}</td>
<td>Member&#39;s consents (similar to <a href="#member-consents-model">Member&#39;s consents JSON model</a>)</td>
<td>JSON Object</td>
</tr>
<tr>
<td>sms_enabled</td>
<td>no</td>
<td>true</td>
<td>Should SMS channel be enabled for member?</td>
<td>Boolean</td>
</tr>
<tr>
<td>email_enabled</td>
<td>no</td>
<td>true</td>
<td>Should email channel be enabled for member?</td>
<td>Boolean</td>
</tr>
<tr>
<td>push_enabled</td>
<td>no</td>
<td>true</td>
<td>Should push channel be enabled for member?</td>
<td>Boolean</td>
</tr>
<tr>
<td>send_sms_welcome_message</td>
<td>no</td>
<td>true</td>
<td>Should SMS welcome message be sent to member?</td>
<td>Boolean</td>
</tr>
<tr>
<td>send_email_welcome_message</td>
<td>no</td>
<td>true</td>
<td>Should email welcome be sent to member</td>
<td>Boolean</td>
</tr>
<tr>
<td>password</td>
<td>depends</td>
<td>none</td>
<td>Member&#39;s password. Not required, but user won&#39;t be able to log in without this when only its email is provided</td>
<td>string</td>
</tr>
<tr>
<td>registration_password</td>
<td>depends</td>
<td>none</td>
<td>Password for registration for member MSISDN verification, see <a href="#members-create-registration-password">above</a></td>
<td></td>
</tr>
</tbody></table>

<p>&ast; At least one of those properties must be provided</p>
<h4 id='response-json-object-1'><span id=response-json-object></span>Response (JSON object)</h4>
<p>Created member properties - see: <a href="#member-model">Member model</a></p>
<h4 id='error-responses-1'><span id=error-responses></span>Error responses</h4>
<table><thead>
<tr>
<th>Status</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td><code>422</code></td>
<td><a href="#validation-on-members">validation errors</a> JSON object.</td>
</tr>
<tr>
<td><code>465</code></td>
<td><code>registration_password</code> or <code>password</code> param is missing</td>
</tr>
<tr>
<td><code>466</code></td>
<td><code>registration_password</code> param is invalid</td>
</tr>
</tbody></table>

<aside class="notice">
Requires <code>BL:Api:Members:Create</code> or <code>BL:Api:Members:CreateWithVerification</code>permit
</aside>

<!--- ############################################################################################################# --->
<h3 id='a-name-members-update-a-update-1'><span id=a-name-members-update-a-update></span><a name="members-update"></a> Update</h3>
<blockquote>
<p>Example:</p>
</blockquote>
<pre class="highlight shell tab-shell"><code>
curl -X PUT <span class="se">\</span>
  https://api.mpc.placewise.com/v3/infinity-mall/members/:id <span class="se">\</span>
  -H <span class="s1">'content-type: application/json'</span> <span class="se">\</span>
  -H <span class="s1">'x-client-authorization: B7t9U9tsoWsGhrv2ouUoSqpM'</span> <span class="se">\</span>
  -H <span class="s1">'x-product-name: default'</span> <span class="se">\</span>
  -H <span class="s1">'x-user-agent: CURL manual test'</span> <span class="se">\</span>
  -d <span class="se">\</span>
  <span class="s1">'{
    "properties": {
      "last_name": "Doge"
    },
    "password": "new_password"
  }'</span>
</code></pre>
<blockquote>
<p>When successful, the above command returns updated member object as depicted <a href="#member-model">here</a></p>

<p>When payload is invalid, validation errors as depicted <a href="#members-create">here</a></p>
</blockquote>

<p><strong>PUT</strong> <code>v3/:loyalty_club_slug/members/:id</code></p>

<aside class="notice">
Requires <code>BL:Api:Members:Update</code> permit
</aside>

<p><strong>PUT</strong> <code>v3/:loyalty_club_slug/members/me</code> <a href="#oauth2">OAuth</a></p>

<aside class="notice">
Requires <code>BL:Api:Members:OAuth:Update</code> permit.
</aside>

<p>Update member&#39;s properties, consents and other with given ones.</p>

<p>It is intended for partial updates:
* not given properties are neither deleted nor overwritten,
* not given attributes (like consents) won&#39;t be changed in any way.</p>

<p>If deleting properties is intended, their value should be sent as <code>null</code>.</p>

<p>This endpoint may return validation errors (<code>422</code>) even for current member properties. 
That&#39;s because loyalty club schema may get changed over time which results in invalidating existing users.</p>

<p>To bypass such validation errors, you may provide <code>validate_partially: true</code> param which will validate and update only 
attributes that were provided in payload. </p>
<h4 id='url-parameters-1'><span id=url-parameters></span>URL Parameters</h4>
<table><thead>
<tr>
<th>Parameter</th>
<th>Description</th>
<th>Type</th>
</tr>
</thead><tbody>
<tr>
<td>id</td>
<td>Member&#39;s ID</td>
<td>integer</td>
</tr>
</tbody></table>
<h4 id='put-parameters-json-1'><span id=put-parameters-json></span>PUT Parameters (JSON)</h4>
<table><thead>
<tr>
<th>Parameter</th>
<th>Description</th>
<th>Type</th>
<th>Default</th>
</tr>
</thead><tbody>
<tr>
<td>properties</td>
<td>JSON with properties for member</td>
<td>JSON Object</td>
<td>null</td>
</tr>
<tr>
<td>consents</td>
<td>Member&#39;s consents (similar to <a href="#member-consents-model">Member&#39;s consents JSON model</a>)</td>
<td>JSON Object</td>
<td>null</td>
</tr>
<tr>
<td>password</td>
<td>Member&#39;s password</td>
<td>string</td>
<td>null</td>
</tr>
<tr>
<td>sms_enabled</td>
<td>Should SMS channel be enabled for member?</td>
<td>Boolean</td>
<td>null</td>
</tr>
<tr>
<td>email_enabled</td>
<td>Should email channel be enabled for member?</td>
<td>Boolean</td>
<td>null</td>
</tr>
<tr>
<td>push_enabled</td>
<td>Should push channel will be enabled for member?</td>
<td>Boolean</td>
<td>null</td>
</tr>
<tr>
<td>validate_partially</td>
<td>Should only provided data be validated?</td>
<td>Boolean</td>
<td>false</td>
</tr>
<tr>
<td>event_occurred_at</td>
<td>See: <a href="#member-event-occured-at-param"><code>event_occurred_at</code> param</a></td>
<td>Date</td>
<td>(current time)</td>
</tr>
</tbody></table>
<h5 id='a-name-member-event-occured-at-param-a-code-event_occurred_at-code-param-1'><span id=a-name-member-event-occured-at-param-a-code-event_occurred_at-code-param></span><a name="member-event-occured-at-param"></a> <code>event_occurred_at</code> param</h5>
<p>When actual member data change occurred at the time different than request&#39;s time, you can utilize the `event_occurred_at&#39; param to pass
the actual update time.</p>

<p>This may be relevant when you want this to be reflected in the member&#39;s changes history.</p>
<h4 id='response-json-object-1'><span id=response-json-object></span>Response (JSON object)</h4>
<p>Member properties after update - see: <a href="#member-model">Member model</a></p>
<h4 id='error-responses-1'><span id=error-responses></span>Error responses</h4>
<table><thead>
<tr>
<th>Status</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td><code>404</code></td>
<td>Member could not be found</td>
</tr>
<tr>
<td><code>422</code></td>
<td><a href="#validation-on-members">validation errors</a> JSON object.</td>
</tr>
</tbody></table>

<!--- ############################################################################################################# --->
<h3 id='a-name-me-update-password-a-update-password-1'><span id=a-name-me-update-password-a-update-password></span><a name="me-update-password"></a> Update password</h3>
<blockquote>
<p>Example:</p>
</blockquote>
<pre class="highlight shell tab-shell"><code>curl -X PUT <span class="se">\</span>
  https://api.mpc.placewise.com/v3/infinity-mall/members/me/update_password <span class="se">\</span>
  -H <span class="s1">'content-type: application/json'</span> <span class="se">\</span>
  -H <span class="s1">'x-client-authorization: B7t9U9tsoWsGhrv2ouUoSqpM'</span> <span class="se">\</span>
  -H <span class="s1">'x-product-name: default'</span> <span class="se">\</span>
  -H <span class="s1">'x-user-agent: CURL manual test'</span> <span class="se">\</span>
  -H <span class="s1">'authorization: Bearer 8433d608645345a45ce5a0f5ba1225e57546e86ac49e5fec842159dc82218522'</span> <span class="se">\</span>
  -d <span class="se">\</span>
  <span class="s1">'{
      "current_password": "123"
      "password": "SuperStrongP4ssw0rd"
  }'</span>
</code></pre>
<blockquote>
<p>Always returns an empty object</p>
</blockquote>
<pre class="highlight json tab-json"><code><span class="p">{</span><span class="w">
  </span><span class="err">//</span><span class="w"> </span><span class="err">Empty</span><span class="w"> </span><span class="err">object</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>
<p><strong>PUT</strong> <code>v3/:loyalty_club_slug/members/update_password</code> <a href="#oauth2">OAuth</a></p>

<p>Updates members&#39;s password.</p>
<h4 id='url-parameters-1'><span id=url-parameters></span>URL Parameters</h4>
<table><thead>
<tr>
<th>Parameter</th>
<th>Description</th>
<th>Type</th>
</tr>
</thead><tbody>
<tr>
<td>password</td>
<td>Member&#39;s new password</td>
<td>string</td>
</tr>
<tr>
<td>current_password</td>
<td>Member&#39;s current password</td>
<td>string</td>
</tr>
</tbody></table>
<h4 id='error-responses-1'><span id=error-responses></span>Error responses</h4>
<table><thead>
<tr>
<th>Status</th>
<th>Reason</th>
</tr>
</thead><tbody>
<tr>
<td><code>404</code></td>
<td>Member associated with given Authorization token does not exist</td>
</tr>
<tr>
<td><code>422</code></td>
<td>Invalid password - returns <a href="#validation-on-members">validation errors</a> JSON object.</td>
</tr>
<tr>
<td><code>460</code></td>
<td>Member not authorized (Invalid or expired OAuth token)</td>
</tr>
<tr>
<td><code>464</code></td>
<td>Invalid current_password</td>
</tr>
</tbody></table>

<aside class="notice">
Requires <code>BL:Api:Members:OAuth:UpdatePassword</code> permit.
</aside>
<h3 id='a-name-members-update-app-token-a-update-app-token-1'><span id=a-name-members-update-app-token-a-update-app-token></span><a name="members-update-app-token"></a> Update app token</h3>
<blockquote>
<p>Example:</p>
</blockquote>
<pre class="highlight shell tab-shell"><code>
curl -X PUT <span class="se">\</span>
  https://api.mpc.placewise.com/v3/infinity-mall/members/:id/update_app_token <span class="se">\</span>
  -H <span class="s1">'content-type: application/json'</span> <span class="se">\</span>
  -H <span class="s1">'x-client-authorization: B7t9U9tsoWsGhrv2ouUoSqpM'</span> <span class="se">\</span>
  -H <span class="s1">'x-product-name: default'</span> <span class="se">\</span>
  -H <span class="s1">'x-user-agent: CURL manual test'</span> <span class="se">\</span>
  -d <span class="se">\</span>
  <span class="s1">'{
     "app_token": "tok3n",
     "app_platform": "android"
   }'</span>
</code></pre>
<blockquote>
<p>When successful, returns an empty object</p>
</blockquote>
<pre class="highlight json tab-json"><code><span class="p">{</span><span class="w">
  </span><span class="err">//</span><span class="w"> </span><span class="err">Empty</span><span class="w"> </span><span class="err">object</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>
<blockquote>
<p>When payload is invalid, returns error response (422)</p>
</blockquote>
<pre class="highlight json tab-json"><code><span class="p">{</span><span class="w">
    </span><span class="s2">"error"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Invalid parameters"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"details"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="s2">"app_token"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
            </span><span class="s2">"must be a string"</span><span class="w">
        </span><span class="p">],</span><span class="w">
        </span><span class="s2">"app_platform"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
            </span><span class="s2">"must be one of: android, ios"</span><span class="w">
        </span><span class="p">]</span><span class="w">
    </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>
<p><strong>PUT</strong> <code>v3/:loyalty_club_slug/members/:id/update_app_token</code></p>

<aside class="notice">
Requires <code>BL:Api:Members:UpdateAppToken</code> permit
</aside>

<p><strong>PUT</strong> <code>v3/:loyalty_club_slug/members/me/update_app_token</code> <a href="#oauth2">OAuth</a></p>

<aside class="notice">
Requires <code>BL:Api:Members:OAuth:UpdateAppToken</code> permit
</aside>

<p>Updates member&#39;s Firebase token, along with platform it&#39;s that it&#39;s associated with. </p>

<p>Token may be removed by sending it as empty string or null, empty payload will also be treated as token removal.
Platform is automatically removed when token is empty.</p>
<h4 id='put-parameters-json-1'><span id=put-parameters-json></span>PUT Parameters (JSON)</h4>
<table><thead>
<tr>
<th>Parameter</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>app_token</td>
<td>string</td>
<td>Firebase push token</td>
</tr>
<tr>
<td>app_platform</td>
<td>string</td>
<td>One of: <code>[&#39;android&#39;, &#39;ios&#39;]</code></td>
</tr>
</tbody></table>
<h4 id='error-responses-1'><span id=error-responses></span>Error responses</h4>
<table><thead>
<tr>
<th>Status</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td><code>404</code></td>
<td>Member could not be found</td>
</tr>
<tr>
<td><code>422</code></td>
<td>Invalid parameters</td>
</tr>
</tbody></table>

<!--- ############################################################################################################# --->
<h3 id='a-name-members-destroy-a-destroy-1'><span id=a-name-members-destroy-a-destroy></span><a name="members-destroy"></a> Destroy</h3>
<p><strong>DELETE</strong> <code>v3/:loyalty_club_slug/members/:id</code></p>

<aside class="notice">
Requires <code>BL:Api:Members:Destroy</code> permit
</aside>

<p><strong>DELETE</strong> <code>v3/:loyalty_club_slug/members/me</code> <a href="#oauth2">OAuth</a></p>

<aside class="notice">
Requires <code>BL:Api:Members:OAuth:Destroy</code> permit.
</aside>

<p>Permanently removes member.</p>

<p>It is possible to trigger optout message by setting <code>send_unsubscribe_message=true</code> query string parameter.
Same as welcome messages, optout messages sending also depends on Loyalty Club and Product configuration.</p>

<blockquote>
<p>Example:</p>
</blockquote>
<pre class="highlight shell tab-shell"><code>curl -X DELETE <span class="se">\</span>
    <span class="s2">"https://api.mpc.placewise.com/v3/infinity-mall/members/:id"</span> <span class="se">\</span>
    -H <span class="s1">'content-type: application/json'</span> <span class="se">\</span>
    -H <span class="s1">'x-client-authorization: B7t9U9tsoWsGhrv2ouUoSqpM'</span> <span class="se">\</span>
    -H <span class="s1">'x-product-name: default'</span> <span class="se">\</span>
    -H <span class="s1">'x-user-agent: CURL manual test'</span>
</code></pre>
<blockquote>
<p>When successful, the above command returns destroyed member object as depicted <a href="#member-model">here</a></p>
</blockquote>
<h4 id='url-parameters-1'><span id=url-parameters></span>URL Parameters</h4>
<table><thead>
<tr>
<th>Parameter</th>
<th>Description</th>
<th>Type</th>
</tr>
</thead><tbody>
<tr>
<td>id</td>
<td>Member&#39;s ID</td>
<td>integer</td>
</tr>
</tbody></table>
<h4 id='query-parameters-1'><span id=query-parameters></span>Query Parameters</h4>
<table><thead>
<tr>
<th>Parameter</th>
<th>Required?</th>
<th>Default</th>
<th>Description</th>
<th>Type</th>
</tr>
</thead><tbody>
<tr>
<td>send_email_unsubscribe_message</td>
<td>no</td>
<td>true</td>
<td>Should optout email be sent to member?</td>
<td>Boolean</td>
</tr>
</tbody></table>
<h4 id='response-json-object-1'><span id=response-json-object></span>Response (JSON object)</h4>
<p>Properties of member that has been destroyed - see: <a href="#member-model">Member model</a></p>
<h4 id='error-responses-1'><span id=error-responses></span>Error responses</h4>
<table><thead>
<tr>
<th>Status</th>
<th>Reason</th>
</tr>
</thead><tbody>
<tr>
<td><code>404</code></td>
<td>Member could not be found</td>
</tr>
<tr>
<td><code>422</code></td>
<td><a href="#validation-on-members">validation errors</a> JSON object.</td>
</tr>
</tbody></table>

<!--- ############################################################################################################# --->
<h3 id='a-name-members-validate-a-validate-1'><span id=a-name-members-validate-a-validate></span><a name="members-validate"></a> Validate</h3>
<blockquote>
<p>Example:</p>
</blockquote>
<pre class="highlight shell tab-shell"><code>
curl -X POST <span class="se">\</span>
  https://api.mpc.placewise.com/v3/infinity-mall/members/validate <span class="se">\</span>
  -H <span class="s1">'content-type: application/json'</span> <span class="se">\</span>
  -H <span class="s1">'x-client-authorization: B7t9U9tsoWsGhrv2ouUoSqpM'</span> <span class="se">\</span>
  -H <span class="s1">'x-product-name: android-app'</span> <span class="se">\</span>
  -H <span class="s1">'X-Subproduct-Name: campaign-10-2017'</span> <span class="se">\</span>
  -H <span class="s1">'x-user-agent: CURL manual test'</span> <span class="se">\</span>
  -d <span class="s1">'{
    "properties": {
        "gender": "wrong",
        "email": "foo@ba.r.ba.z"
    },
    "registration_password": "a145"
  }'</span>

</code></pre>
<blockquote>
<p>When data is valid, returns JSON object structured like this </p>
</blockquote>
<pre class="highlight json tab-json"><code><span class="p">{</span><span class="w">
    </span><span class="s2">"valid"</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span><span class="w">
    </span><span class="s2">"errors"</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>
<blockquote>
<p>When data is not valid, returns JSON object structured like this </p>
</blockquote>
<pre class="highlight json tab-json"><code><span class="p">{</span><span class="w">
    </span><span class="s2">"valid"</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span><span class="w">
    </span><span class="s2">"errors"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="s2">"properties"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
            </span><span class="p">{</span><span class="w">
                </span><span class="s2">"error"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
                    </span><span class="s2">"gender"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
                        </span><span class="p">{</span><span class="w"> </span><span class="s2">"error"</span><span class="p">:</span><span class="w"> </span><span class="s2">"value_not_match"</span><span class="p">,</span><span class="w"> </span><span class="s2">"property"</span><span class="p">:</span><span class="w"> </span><span class="s2">"gender"</span><span class="p">,</span><span class="w"> </span><span class="s2">"value"</span><span class="p">:</span><span class="w"> </span><span class="s2">"wrong"</span><span class="p">,</span><span class="w"> </span><span class="s2">"values"</span><span class="p">:</span><span class="w"> </span><span class="s2">"man, woman"</span><span class="w"> </span><span class="p">}</span><span class="w">
                    </span><span class="p">]</span><span class="w">
                </span><span class="p">}</span><span class="w">
            </span><span class="p">}</span><span class="w">
        </span><span class="p">],</span><span class="w">
        </span><span class="s2">"email"</span><span class="p">:</span><span class="w"> </span><span class="p">[{</span><span class="w"> </span><span class="s2">"error"</span><span class="p">:</span><span class="w"> </span><span class="s2">"invalid_mx"</span><span class="p">,</span><span class="w"> </span><span class="s2">"property"</span><span class="p">:</span><span class="w"> </span><span class="s2">"email"</span><span class="p">}</span><span class="w">
        </span><span class="p">],</span><span class="w">
        </span><span class="s2">"registration_password"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
            </span><span class="p">{</span><span class="w">
                </span><span class="s2">"error"</span><span class="p">:</span><span class="w"> </span><span class="s2">"invalid"</span><span class="w">
            </span><span class="p">}</span><span class="w">
        </span><span class="p">]</span><span class="w">
    </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>
<p><strong>POST</strong> <code>v3/:loyalty_club_slug/members/validate</code></p>

<p>Checks if given data is valid for new member registration. Returns successful response (200), regardless of data validity.</p>
<h4 id='about-partial-validation-mechanism-1'><span id=about-partial-validation-mechanism></span>About partial validation mechanism</h4>
<p>Only properties which keys are present in given payload will be checked against presence validation.</p>

<p>For example, let&#39;s say that Loyalty Club configuration requires member to have <code>msisdn</code> property set.</p>

<ul>
<li>if <code>&quot;msisdn&quot;: &quot;&quot;</code> or<code>&quot;msisdn&quot;: null</code>&quot; is present in the payload, the validation will return error stating that <code>msisdn</code> must be present.</li>
<li>however, when payload doesn&#39;t include the <code>msisdn</code> key, such error will not be returned.</li>
</ul>

<p>This behaviour has been designed to allow validate member partially, property by property. This way you can choose 
what values should be validated at specific point of registration.</p>
<h4 id='a-name-members-validate-post-parameters-a-post-parameters-json-1'><span id=a-name-members-validate-post-parameters-a-post-parameters-json></span><a name="members-validate-post-parameters"></a> POST Parameters (JSON)</h4>
<p>Following keys of <a href="#members-create-post-parameters">Members &gt; Create</a> payload are supported when validating:</p>

<ul>
<li>properties</li>
<li>consents</li>
<li>registration_password</li>
</ul>
<h4 id='response-json-object-1'><span id=response-json-object></span>Response (JSON object)</h4>
<table><thead>
<tr>
<th>Key</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>valid</td>
<td>boolean</td>
<td>Is the data valid?</td>
</tr>
<tr>
<td>errors</td>
<td>object</td>
<td><a href="#validation-on-members">validation errors</a> JSON object, <code>null</code> when data is valid</td>
</tr>
</tbody></table>

<aside class="notice">
Requires <code>BL:Api:Members:Validate</code> permit
</aside>
<h3 id='a-name-members-reset-password-a-reset-password-1'><span id=a-name-members-reset-password-a-reset-password></span><a name="members-reset-password"></a> Reset password</h3>
<blockquote>
<p>Example:</p>
</blockquote>
<pre class="highlight shell tab-shell"><code>curl -X PUT <span class="se">\</span>
  <span class="s2">"https://api.mpc.placewise.com/v3/:loyalty_club_slug/members/by_email/:email/reset_password"</span> <span class="se">\</span>
  -H <span class="s1">'content-type: application/json'</span> <span class="se">\</span>
  -H <span class="s1">'x-client-authorization: B7t9U9tsoWsGhrv2ouUoSqpM'</span> <span class="se">\</span>
  -H <span class="s1">'x-product-name: default'</span> <span class="se">\</span>
  -H <span class="s1">'x-user-agent: CURL manual test'</span> <span class="se">\</span>
  -d <span class="se">\</span>
    <span class="s1">'{
      "password": "new_password",
      "token": "k4wort03j2"
    }'</span>
</code></pre>
<blockquote>
<p>When successful, returns an empty object:</p>
</blockquote>
<pre class="highlight json tab-json"><code><span class="p">{</span><span class="w">
  </span><span class="err">//</span><span class="w"> </span><span class="err">Empty</span><span class="w"> </span><span class="err">object</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>
<p><strong>PUT</strong> <code>/v3/:loyalty_club_slug/members/by_email/:email/reset_password</code></p>

<p>Updates given member password if token is valid.</p>
<h4 id='url-parameters-1'><span id=url-parameters></span>URL Parameters</h4>
<table><thead>
<tr>
<th>Parameter</th>
<th>Description</th>
<th>Type</th>
</tr>
</thead><tbody>
<tr>
<td>password</td>
<td>Member&#39;s new password</td>
<td>string</td>
</tr>
<tr>
<td>token</td>
<td>Confirmation token generated and sent with <a href="#members-send-password-reset-token">Members &gt; Send password reset token</a></td>
<td>string</td>
</tr>
</tbody></table>
<h4 id='error-responses-1'><span id=error-responses></span>Error responses</h4>
<table><thead>
<tr>
<th>Status</th>
<th>Reason</th>
</tr>
</thead><tbody>
<tr>
<td><code>400</code></td>
<td><code>password</code> or <code>token</code> param is missing</td>
</tr>
<tr>
<td><code>404</code></td>
<td>Member could not be found</td>
</tr>
<tr>
<td><code>422</code></td>
<td>Invalid password - returns <a href="#validation-on-members">validation errors</a> JSON object.</td>
</tr>
<tr>
<td><code>463</code></td>
<td>Invalid confirmation token</td>
</tr>
</tbody></table>

<aside class="notice">
Requires <code>BL:Api:Members:ResetPassword</code> permit
</aside>

<!--- ############################################################################################################# --->
<h3 id='a-name-members-send-password-reset-token-a-send-password-reset-token-1'><span id=a-name-members-send-password-reset-token-a-send-password-reset-token></span><a name="members-send-password-reset-token"></a> Send password reset token</h3>
<blockquote>
<p>Example:</p>
</blockquote>
<pre class="highlight shell tab-shell"><code>curl <span class="s2">"https://api.mpc.placewise.com/v3/infinity-mall/members/by_email/joe@example.com/send_password_reset_token"</span> <span class="se">\</span>
  -H <span class="s1">'content-type: application/json'</span> <span class="se">\</span>
  -H <span class="s1">'x-client-authorization: B7t9U9tsoWsGhrv2ouUoSqpM'</span> <span class="se">\</span>
  -H <span class="s1">'x-product-name: default'</span> <span class="se">\</span>
  -H <span class="s1">'x-user-agent: CURL manual test'</span>
</code></pre>
<blockquote>
<p>Always returns an empty JSON object</p>
</blockquote>
<pre class="highlight json tab-json"><code><span class="p">{</span><span class="w">
  </span><span class="err">//</span><span class="w"> </span><span class="err">Empty</span><span class="w"> </span><span class="err">object</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>
<p><strong>POST</strong> <code>/v3/:loyalty_club_slug/members/by_email/:email/send_password_reset_token</code></p>

<p>Sends password reset link to given e-mail address if it is associated with member in given loyalty club.</p>

<p>The e-mail contains a token generated for member, valid for 24 hours.</p>

<p>The token can be then used to reset password with <a href="#members-reset-password">Members &gt; Reset password</a>.
It also may be verified with <a href="#members-verify-token">Members &gt; Verify token</a></p>
<h4 id='url-parameters-1'><span id=url-parameters></span>URL Parameters</h4>
<table><thead>
<tr>
<th>Parameter</th>
<th>Description</th>
<th>Type</th>
</tr>
</thead><tbody>
<tr>
<td>email</td>
<td>Member&#39;s email</td>
<td>string (email)</td>
</tr>
</tbody></table>

<aside class="notice">
Requires <code>BL:Api:Members:Tokens:Create</code> permit
</aside>

<!--- ############################################################################################################# --->
<h3 id='a-name-members-send-one-time-password-a-send-one-time-password-1'><span id=a-name-members-send-one-time-password-a-send-one-time-password></span><a name="members-send-one-time-password"></a> Send one time password</h3>
<blockquote>
<p>Example - Sending OTP SMS</p>
</blockquote>
<pre class="highlight shell tab-shell"><code>curl <span class="s2">"https://api.mpc.placewise.com/v3/infinity-mall/members/by_msisdn/4740769126/send_one_time_password_via_sms"</span> <span class="se">\</span>
  -H <span class="s1">'content-type: application/json'</span> <span class="se">\</span>
  -H <span class="s1">'x-client-authorization: B7t9U9tsoWsGhrv2ouUoSqpM'</span> <span class="se">\</span>
  -H <span class="s1">'x-product-name: default'</span> <span class="se">\</span>
  -H <span class="s1">'x-user-agent: CURL manual test'</span>
</code></pre>
<blockquote>
<p>Example - Sending OTP email</p>
</blockquote>
<pre class="highlight shell tab-shell"><code>curl <span class="s2">"https://api.mpc.placewise.com/v3/infinity-mall/members/by_email/user@example.com/send_one_time_password_via_email"</span> <span class="se">\</span>
  -H <span class="s1">'content-type: application/json'</span> <span class="se">\</span>
  -H <span class="s1">'x-client-authorization: B7t9U9tsoWsGhrv2ouUoSqpM'</span> <span class="se">\</span>
  -H <span class="s1">'x-product-name: default'</span> <span class="se">\</span>
  -H <span class="s1">'x-user-agent: CURL manual test'</span>
</code></pre>
<blockquote>
<p>Always returns an empty JSON object</p>
</blockquote>
<pre class="highlight json tab-json"><code><span class="p">{</span><span class="w">
  </span><span class="err">//</span><span class="w"> </span><span class="err">Empty</span><span class="w"> </span><span class="err">object</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>
<p><strong>POST</strong> <code>/v3/:loyalty_club_slug/members/by_msisdn/:msisdn/send_one_time_password_via_sms</code></p>

<p>&nbsp; &nbsp; &nbsp; &nbsp; Sends a login SMS to member identified by given MSISDN</p>

<p><strong>POST</strong> <code>/v3/:loyalty_club_slug/members/by_email/:email/send_one_time_password_via_sms</code></p>

<p>&nbsp; &nbsp; &nbsp; &nbsp; Sends a login SMS to member identified by given email</p>

<p><strong>POST</strong> <code>/v3/:loyalty_club_slug/members/by_msisdn/:msisdn/send_one_time_password_via_email</code></p>

<p>&nbsp; &nbsp; &nbsp; &nbsp; Sends a login email to member identified by given MSISDN</p>

<p><strong>POST</strong> <code>/v3/:loyalty_club_slug/members/by_email/:email/send_one_time_password_via_email</code></p>

<p>&nbsp; &nbsp; &nbsp; &nbsp; Sends a login email to member identified by given email</p>

<p><strong>POST</strong> <code>/v3/:loyalty_club_slug/members/by_msisdn/:msisdn/send_one_time_password</code></p>

<p>&nbsp; &nbsp; &nbsp; &nbsp; (DEPRECATED) Sends a login SMS to member identified by msisdn</p>

<p><strong>POST</strong> <code>/v3/:loyalty_club_slug/members/by_email/:email/send_one_time_password</code></p>

<p>&nbsp; &nbsp; &nbsp; &nbsp; (DEPRECATED) Sends a login email to member identified by given email</p>

<p>The message may contain (depending on Loyalty Club configuration):</p>

<ul>
<li>Generated password, valid for limited time, allows to sign in member - see: <a href="#token-create">OAuth Token &gt; Create</a>. </li>
<li>Login URL. Scheme of this URL is: <code>&lt;login_url&gt;?otp=&lt;otp&gt;</code>. 
By default, <code>login_url</code> leads to MPC Webforms page. However, it may by customized by providing <code>login_url</code> query param.</li>
</ul>
<h4 id='url-parameters-1'><span id=url-parameters></span>URL Parameters</h4>
<table><thead>
<tr>
<th>Parameter</th>
<th>Description</th>
<th>Type</th>
</tr>
</thead><tbody>
<tr>
<td>email</td>
<td>Member&#39;s email</td>
<td>e-mail</td>
</tr>
<tr>
<td>msisdn</td>
<td>Member&#39;s msisdn</td>
<td>string (format as defined <a href="#msisdn-param">here</a> - example: <code>4740769126</code>)</td>
</tr>
</tbody></table>
<h4 id='query-parameters-1'><span id=query-parameters></span>Query Parameters</h4>
<table><thead>
<tr>
<th>Parameter</th>
<th>Description</th>
<th>Type</th>
</tr>
</thead><tbody>
<tr>
<td>login_url</td>
<td>Custom login URL</td>
<td>String</td>
</tr>
</tbody></table>
<h4 id='error-responses-1'><span id=error-responses></span>Error responses</h4>
<table><thead>
<tr>
<th>Status</th>
<th>Reason</th>
</tr>
</thead><tbody>
<tr>
<td><code>404</code></td>
<td>Member not found</td>
</tr>
</tbody></table>

<aside class="notice">
Requires <code>BL:Api:Members:CreateOneTimePassword</code> permit
</aside>

<!--- ############################################################################################################# --->
<h3 id='a-name-members-send-registration-password-a-send-registration-password-1'><span id=a-name-members-send-registration-password-a-send-registration-password></span><a name="members-send-registration-password"></a> Send registration password</h3>
<blockquote>
<p>Example - Sending registration password SMS</p>
</blockquote>
<pre class="highlight shell tab-shell"><code>curl <span class="s2">"https://api.mpc.placewise.com/v3/infinity-mall/members/by_msisdn/4740769126/send_registration_password"</span> <span class="se">\</span>
  -H <span class="s1">'content-type: application/json'</span> <span class="se">\</span>
  -H <span class="s1">'x-client-authorization: B7t9U9tsoWsGhrv2ouUoSqpM'</span> <span class="se">\</span>
  -H <span class="s1">'x-product-name: default'</span> <span class="se">\</span>
  -H <span class="s1">'x-user-agent: CURL manual test'</span>
</code></pre>
<blockquote>
<p>Example - Sending registration password email</p>
</blockquote>
<pre class="highlight shell tab-shell"><code>curl <span class="s2">"https://api.mpc.placewise.com/v3/infinity-mall/members/by_email/user@example.com/send_registration_password"</span> <span class="se">\</span>
  -H <span class="s1">'content-type: application/json'</span> <span class="se">\</span>
  -H <span class="s1">'x-client-authorization: B7t9U9tsoWsGhrv2ouUoSqpM'</span> <span class="se">\</span>
  -H <span class="s1">'x-product-name: default'</span> <span class="se">\</span>
  -H <span class="s1">'x-user-agent: CURL manual test'</span>
</code></pre>
<blockquote>
<p>Always returns an empty JSON object</p>
</blockquote>
<pre class="highlight json tab-json"><code><span class="p">{</span><span class="w">
  </span><span class="err">//</span><span class="w"> </span><span class="err">Empty</span><span class="w"> </span><span class="err">object</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>
<p><strong>POST</strong> <code>/v3/:loyalty_club_slug/members/by_msisdn/:msisdn/send_registration_password</code></p>

<p>&nbsp; &nbsp; &nbsp; &nbsp; Sends a registration SMS to member identified by msisdn</p>

<p><strong>POST</strong> <code>/v3/:loyalty_club_slug/members/by_email/:email/send_registration_password</code></p>

<p>&nbsp; &nbsp; &nbsp; &nbsp; Sends a registration email to member identified by given email</p>

<p>The message may contain (depending on Loyalty Club configuration):</p>

<ul>
<li>Generated password, valid for limited time, allows to <a href="#members-create">register</a> the member. </li>
<li>Registration URL. Scheme of this URL is: <code>&lt;registration_url&gt;?otp=&lt;otp&gt;</code>. 
By default, <code>registration_url</code> leads to MPC Webforms page. However, it may by customized by 
providing <code>registration_url</code> query param.</li>
</ul>
<h4 id='url-parameters-1'><span id=url-parameters></span>URL Parameters</h4>
<table><thead>
<tr>
<th>Parameter</th>
<th>Description</th>
<th>Type</th>
</tr>
</thead><tbody>
<tr>
<td>email</td>
<td>Member&#39;s email</td>
<td>e-mail</td>
</tr>
<tr>
<td>msisdn</td>
<td>Member&#39;s msisdn</td>
<td>string (format as defined <a href="#msisdn-param">here</a> - example: <code>4740769126</code>)</td>
</tr>
</tbody></table>
<h4 id='query-parameters-1'><span id=query-parameters></span>Query Parameters</h4>
<table><thead>
<tr>
<th>Parameter</th>
<th>Description</th>
<th>Type</th>
</tr>
</thead><tbody>
<tr>
<td>login_url</td>
<td>Custom login URL</td>
<td>String</td>
</tr>
<tr>
<td>language</td>
<td>Language of the registration password message. When not provided, default LC language will be used</td>
<td>string</td>
</tr>
</tbody></table>
<h4 id='error-responses-1'><span id=error-responses></span>Error responses</h4>
<table><thead>
<tr>
<th>Status</th>
<th>Reason</th>
</tr>
</thead><tbody>
<tr>
<td><code>404</code></td>
<td>Member not found</td>
</tr>
</tbody></table>

<aside class="notice">
Requires <code>BL:Api:Members:CreateRegistrationPassword</code> permit
</aside>
<h3 id='a-name-members-verify-token-a-verify-token-1'><span id=a-name-members-verify-token-a-verify-token></span><a name="members-verify-token"></a> Verify token</h3>
<blockquote>
<p>Example:</p>
</blockquote>
<pre class="highlight shell tab-shell"><code>curl <span class="s2">"https://api.mpc.placewise.com/v3/infinity-mall/members/by_email/joe@example.com/verify_token/password_reset/k4wort03j2"</span> <span class="se">\</span>
  -H <span class="s1">'content-type: application/json'</span> <span class="se">\</span>
  -H <span class="s1">'x-client-authorization: B7t9U9tsoWsGhrv2ouUoSqpM'</span> <span class="se">\</span>
  -H <span class="s1">'x-product-name: default'</span> <span class="se">\</span>
  -H <span class="s1">'x-user-agent: CURL manual test'</span>
</code></pre>
<blockquote>
<p>Example response:</p>
</blockquote>
<pre class="highlight json tab-json"><code><span class="p">{</span><span class="w">
  </span><span class="s2">"valid"</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>
<p><strong>GET</strong> <code>/v3/:loyalty_club_slug/members/by_email/:email/verify_token/:type/:token</code></p>

<p>Verifies given member token. Returns response indicating if given token is (still) valid.</p>
<h4 id='url-parameters-1'><span id=url-parameters></span>URL Parameters</h4>
<table><thead>
<tr>
<th>Parameter</th>
<th>Description</th>
<th>Type</th>
</tr>
</thead><tbody>
<tr>
<td>email</td>
<td>Member&#39;s email</td>
<td>string (email)</td>
</tr>
<tr>
<td>type</td>
<td>Token type</td>
<td><code>password_reset</code> (more types in future)</td>
</tr>
<tr>
<td>token</td>
<td>Token</td>
<td>string</td>
</tr>
</tbody></table>
<h4 id='response-json-object-1'><span id=response-json-object></span>Response (JSON object)</h4>
<table><thead>
<tr>
<th>Key</th>
<th>Type</th>
</tr>
</thead><tbody>
<tr>
<td>valid</td>
<td>boolean</td>
</tr>
</tbody></table>
<h4 id='error-responses-1'><span id=error-responses></span>Error responses</h4>
<table><thead>
<tr>
<th>Status</th>
<th>Reason</th>
</tr>
</thead><tbody>
<tr>
<td><code>400</code></td>
<td>Invalid <code>type</code></td>
</tr>
</tbody></table>

<aside class="notice">
Requires <code>BL:Api:Members:Tokens:Verify</code> permit
</aside>

<!--- ############################################################################################################# --->
<h3 id='a-name-members-send-verification-sms-a-send-msisdn-verification-sms-1'><span id=a-name-members-send-verification-sms-a-send-msisdn-verification-sms></span><a name="members-send-verification-sms"></a> Send MSISDN verification SMS</h3>
<blockquote>
<p>Example:</p>
</blockquote>
<pre class="highlight shell tab-shell"><code>curl -X PUT <span class="se">\</span>
  <span class="s2">"https://api.mpc.placewise.com/v3/infinity-mall/members/channels/msisdn/4740769126/send_verification"</span> <span class="se">\</span>
  -H <span class="s1">'content-type: application/json'</span> <span class="se">\</span>
  -H <span class="s1">'x-client-authorization: B7t9U9tsoWsGhrv2ouUoSqpM'</span> <span class="se">\</span>
  -H <span class="s1">'x-product-name: default'</span> <span class="se">\</span>
  -H <span class="s1">'x-user-agent: CURL manual test'</span> <span class="se">\</span>
  -d <span class="se">\</span>
    <span class="s1">'{
      "for_mobile_app": false
    }'</span>
</code></pre>
<p><strong>PUT</strong> <code>/v3/:loyalty_club_slug/members/channels/msisdn/:msisdn/send_verification</code></p>

<p>Generates a verification token for member identified by given MSISDN and sends it to him with an SMS message.
The token is valid for 30 days.</p>

<p>By default, a link to Webforms is sent.
When <code>for_mobile_app = true</code> param is provided, a deep link to mobile app is generated instead.</p>
<h4 id='put-body-parameters-1'><span id=put-body-parameters></span>PUT body parameters</h4>
<table><thead>
<tr>
<th>Parameter</th>
<th>Type</th>
<th>Required?</th>
<th>Default</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>for_mobile_app</td>
<td>boolean</td>
<td>no</td>
<td>false</td>
<td>Should a deep-link to mobile app be generated?</td>
</tr>
</tbody></table>
<h4 id='response-1'><span id=response></span>Response</h4>
<p>Always returns <code>204 (No content)</code></p>

<aside class="notice">
Requires <code>BL:Api:Members:Msisdns:Verify</code> permit
</aside>

<!--- ############################################################################################################# --->
<h3 id='a-name-members-verify-msisdn-a-verify-msisdn-1'><span id=a-name-members-verify-msisdn-a-verify-msisdn></span><a name="members-verify-msisdn"></a> Verify MSISDN</h3>
<blockquote>
<p>Example:</p>
</blockquote>
<pre class="highlight shell tab-shell"><code>curl -X PUT <span class="se">\</span>
  <span class="s2">"https://api.mpc.placewise.com/v3/infinity-mall/members/channels/msisdn/4740769126/verify"</span> <span class="se">\</span>
  -H <span class="s1">'content-type: application/json'</span> <span class="se">\</span>
  -H <span class="s1">'x-client-authorization: B7t9U9tsoWsGhrv2ouUoSqpM'</span> <span class="se">\</span>
  -H <span class="s1">'x-product-name: default'</span> <span class="se">\</span>
  -H <span class="s1">'x-user-agent: CURL manual test'</span> <span class="se">\</span>
  -d <span class="se">\</span>
    <span class="s1">'{
      "token": "shNWPezzYoIuJV2qDIcQrdFQqUdlVdquwUJrNb2Nuw"
    }'</span>
</code></pre>
<blockquote>
<p>When successful, returns an empty object:</p>
</blockquote>
<pre class="highlight json tab-json"><code><span class="p">{</span><span class="w">
  </span><span class="err">//</span><span class="w"> </span><span class="err">Empty</span><span class="w"> </span><span class="err">object</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>
<p><strong>PUT</strong> <code>/v3/:loyalty_club_slug/members/channels/msisdn/:msisdn/verify</code></p>

<p>Uses given token (sent with <a href="#members-send-verification-sms">Members &gt; Send MSISDN verification SMS</a>) to verify
user identified with given MSISDN.</p>
<h4 id='put-body-parameters-1'><span id=put-body-parameters></span>PUT body parameters</h4>
<table><thead>
<tr>
<th>Parameter</th>
<th>Type</th>
<th>Required?</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>token</td>
<td>string</td>
<td>yes</td>
<td>Token generated and sent with <a href="#members-send-verification-sms">Members &gt; Send MSISDN verification SMS</a></td>
</tr>
</tbody></table>
<h4 id='error-responses-1'><span id=error-responses></span>Error responses</h4>
<table><thead>
<tr>
<th>Status</th>
<th>Reason</th>
</tr>
</thead><tbody>
<tr>
<td><code>400</code></td>
<td>Token missing</td>
</tr>
<tr>
<td><code>463</code></td>
<td>Invalid token (it may not exist, or not match the user or be expired)</td>
</tr>
</tbody></table>

<aside class="notice">
Requires <code>BL:Api:Members:Msisdns:Verify</code> permit
</aside>
<h3 id='a-name-members-add-app-tokens-a-add-app-tokens-1'><span id=a-name-members-add-app-tokens-a-add-app-tokens></span><a name="members-add-app-tokens"></a> Add app tokens</h3>
<blockquote>
<p>Example:</p>
</blockquote>
<pre class="highlight shell tab-shell"><code>
curl -X POST <span class="se">\</span>
  https://api.mpc.placewise.com/v3/infinity-mall/members/me/app_tokens <span class="se">\</span>
  -H <span class="s1">'content-type: application/json'</span> <span class="se">\</span>
  -H <span class="s1">'x-client-authorization: B7t9U9tsoWsGhrv2ouUoSqpM'</span> <span class="se">\</span>
  -H <span class="s1">'x-product-name: facebook'</span> <span class="se">\</span>
  -H <span class="s1">'X-Subproduct-Name: campaign-10-2017'</span> <span class="se">\</span>
  -H <span class="s1">'x-user-agent: CURL manual test'</span> <span class="se">\</span>
  -d <span class="s1">'{
        "token": "token",
        "platform": "ios",
        "app_installation_id": "app id",
        "firebase_project_slug": "project slug"
    }'</span>

</code></pre>
<blockquote>
<p>When successful, returns 200</p>
</blockquote>

<p><strong>POST</strong> <code>v3/:loyalty_club_slug/members/me/app_tokens</code></p>

<aside class="notice">
Requires <code>BL:Api:Members:AppTokens:CreateOrUpdate</code> permit
</aside>
<h4 id='request-parameters-json-1'><span id=request-parameters-json></span>Request parameters (JSON)</h4>
<table><thead>
<tr>
<th>Parameter</th>
<th>Description</th>
<th>Type</th>
</tr>
</thead><tbody>
<tr>
<td>token</td>
<td>Push app token</td>
<td>string</td>
</tr>
<tr>
<td>platform</td>
<td>App platform</td>
<td>string (<code>ios</code>, <code>android</code>)</td>
</tr>
<tr>
<td>app_installation_id</td>
<td>app id</td>
<td>string</td>
</tr>
<tr>
<td>firebase_project_slug</td>
<td>Firebase project slug</td>
<td>string</td>
</tr>
</tbody></table>
<h4 id='response-json-object-1'><span id=response-json-object></span>Response (JSON object)</h4>
<p>Empty object {}</p>
<h5 id='error-responses-1'><span id=error-responses></span>Error responses</h5>
<table><thead>
<tr>
<th>Status</th>
<th>Reason</th>
</tr>
</thead><tbody>
<tr>
<td><code>404</code></td>
<td>Member with given identifier could not found</td>
</tr>
<tr>
<td><code>422</code></td>
<td>Invalid parameters</td>
</tr>
</tbody></table>
