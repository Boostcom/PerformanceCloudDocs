<h2 id='members-webhooks-1'><span id=members-webhooks></span>Members Webhooks</h2>
<p>A Loyalty Club may be configured to send notifications (as HTTP POST requests) when a change occurs within its member 
database (e.g. when member registers).</p>

<p>If you wish to configure a Loyalty Club to have such notifications enabled, please contact us us.
You will need to provide us a HTTPS (for security reasons, we don&#39;t support HTTP) URL that notifications will
be sent to.</p>
<h3 id='subscription-1'><span id=subscription></span>Subscription</h3>
<p>As it is possible to have multiple endpoints configured for receiving notifications in one Loyalty Club, for each 
endpoint we setup a Subscription.</p>

<p>Each Subscription has its own Secret Token (see below) and may be configured to send notifications only on specific 
changes (<code>import</code>, <code>update</code>, <code>delete</code>).</p>
<h3 id='authentication-token-1'><span id=authentication-token></span>Authentication token</h3>
<p>Each notification request is signed with <code>X-Secret-Token</code> header that contains Secret Token configured for given 
Subscription.</p>

<p>In order to assure that notifications you receive are sent from us, you should check if its value matches 
the Secret Token that you received from us when the subscription has been set up.</p>
<h3 id='notifications-format-1'><span id=notifications-format></span>Notifications format</h3>
<p>Currently, notifications are generated in two versions. 
Version 1 is deprecated and new subscriptions are going to be configured to receive v2 notifications.</p>
<h4 id='notifications-v2-1'><span id=notifications-v2></span>Notifications v2</h4>
<blockquote>
<p>Example for v2</p>
</blockquote>
<pre class="highlight json tab-json"><code><span class="p">{</span><span class="w">
  </span><span class="s2">"version"</span><span class="p">:</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w">
  </span><span class="s2">"events"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
    </span><span class="p">{</span><span class="w">
      </span><span class="s2">"event"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="s2">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"update"</span><span class="p">,</span><span class="w"> </span><span class="s2">"date"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2020-02-05T14:31:15.520Z"</span><span class="w"> </span><span class="p">},</span><span class="w">
      </span><span class="s2">"loyalty_club"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="s2">"id"</span><span class="p">:</span><span class="w"> </span><span class="mi">32</span><span class="p">,</span><span class="w"> </span><span class="s2">"slug"</span><span class="p">:</span><span class="w"> </span><span class="s2">"infinity-mall"</span><span class="w"> </span><span class="p">},</span><span class="w">
      </span><span class="s2">"member"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="s2">"id"</span><span class="p">:</span><span class="w"> </span><span class="mi">11256</span><span class="p">,</span><span class="w">
        </span><span class="s2">"person_id"</span><span class="p">:</span><span class="w"> </span><span class="mi">89103</span><span class="p">,</span><span class="w">
        </span><span class="s2">"msisdn"</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span><span class="w">
        </span><span class="s2">"email"</span><span class="p">:</span><span class="w"> </span><span class="s2">"john@example.com"</span><span class="p">,</span><span class="w">
        </span><span class="s2">"properties"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="s2">"first_name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"John"</span><span class="p">,</span><span class="w"> </span><span class="s2">"last_name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Doe"</span><span class="p">,</span><span class="w"> </span><span class="s2">"zip_code"</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="w"> </span><span class="p">},</span><span class="w">
        </span><span class="s2">"consents"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
          </span><span class="s2">"sms_marketing"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="s2">"updated_at"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2020-01-21T10:23:34.982Z"</span><span class="p">,</span><span class="w"> </span><span class="s2">"value"</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="w"> </span><span class="p">},</span><span class="w">
          </span><span class="s2">"email_marketing"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="s2">"updated_at"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2020-02-05T14:31:15.520Z"</span><span class="p">,</span><span class="w"> </span><span class="s2">"value"</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="w"> </span><span class="p">}</span><span class="w">
        </span><span class="p">},</span><span class="w">
        </span><span class="s2">"sms_status"</span><span class="p">:</span><span class="w"> </span><span class="s2">"verified"</span><span class="p">,</span><span class="w">
        </span><span class="s2">"email_status"</span><span class="p">:</span><span class="w"> </span><span class="s2">"enabled"</span><span class="p">,</span><span class="w">
        </span><span class="s2">"push_status"</span><span class="p">:</span><span class="w"> </span><span class="s2">"disabled"</span><span class="p">,</span><span class="w">
        </span><span class="s2">"optin_channel"</span><span class="p">:</span><span class="w"> </span><span class="s2">"ios"</span><span class="p">,</span><span class="w">
        </span><span class="s2">"optin_subchannel"</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span><span class="w">
        </span><span class="s2">"created_at"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2020-01-21T10:23:34.982Z"</span><span class="p">,</span><span class="w">
        </span><span class="s2">"updated_at"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2020-02-05T14:31:15.520Z"</span><span class="w">
      </span><span class="p">},</span><span class="w">
      </span><span class="s2">"member_changes"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="s2">"msisdn"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="s2">"change"</span><span class="p">:</span><span class="w"> </span><span class="s2">"-"</span><span class="p">,</span><span class="w"> </span><span class="s2">"was"</span><span class="p">:</span><span class="w"> </span><span class="s2">"4740769126"</span><span class="p">,</span><span class="w"> </span><span class="s2">"is"</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="w"> </span><span class="p">},</span><span class="w">
        </span><span class="s2">"email"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="s2">"change"</span><span class="p">:</span><span class="w"> </span><span class="s2">"+"</span><span class="p">,</span><span class="w"> </span><span class="s2">"was"</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span><span class="w"> </span><span class="s2">"is"</span><span class="p">:</span><span class="w"> </span><span class="s2">"john@example.com"</span><span class="w"> </span><span class="p">},</span><span class="w">
        </span><span class="s2">"sms_status"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="s2">"change"</span><span class="p">:</span><span class="w"> </span><span class="s2">"~"</span><span class="p">,</span><span class="w"> </span><span class="s2">"was"</span><span class="p">:</span><span class="w"> </span><span class="s2">"enabled"</span><span class="p">,</span><span class="w"> </span><span class="s2">"is"</span><span class="p">:</span><span class="w"> </span><span class="s2">"verified"</span><span class="w"> </span><span class="p">},</span><span class="w">
        </span><span class="s2">"push_status"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="s2">"change"</span><span class="p">:</span><span class="w"> </span><span class="s2">"~"</span><span class="p">,</span><span class="w"> </span><span class="s2">"was"</span><span class="p">:</span><span class="w"> </span><span class="s2">"enabled"</span><span class="p">,</span><span class="w"> </span><span class="s2">"is"</span><span class="p">:</span><span class="w"> </span><span class="s2">"disabled"</span><span class="w"> </span><span class="p">},</span><span class="w">
        </span><span class="s2">"properties"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
          </span><span class="s2">"first_name"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="s2">"change"</span><span class="p">:</span><span class="w"> </span><span class="s2">"~"</span><span class="p">,</span><span class="w"> </span><span class="s2">"was"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Mark"</span><span class="p">,</span><span class="w"> </span><span class="s2">"is"</span><span class="p">:</span><span class="w"> </span><span class="s2">"John"</span><span class="w"> </span><span class="p">},</span><span class="w">
          </span><span class="s2">"last_name"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="s2">"change"</span><span class="p">:</span><span class="w"> </span><span class="s2">"+"</span><span class="p">,</span><span class="w"> </span><span class="s2">"was"</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span><span class="w">  </span><span class="s2">"is"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Doe"</span><span class="w"> </span><span class="p">},</span><span class="w">
          </span><span class="s2">"zip_code"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="s2">"change"</span><span class="p">:</span><span class="w"> </span><span class="s2">"-"</span><span class="p">,</span><span class="w"> </span><span class="s2">"was"</span><span class="p">:</span><span class="w"> </span><span class="s2">"3300"</span><span class="p">,</span><span class="w"> </span><span class="s2">"is"</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="w"> </span><span class="p">}</span><span class="w">
        </span><span class="p">},</span><span class="w">
        </span><span class="s2">"consents"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
          </span><span class="s2">"sms_marketing"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="s2">"change"</span><span class="p">:</span><span class="w"> </span><span class="s2">"~"</span><span class="p">,</span><span class="w"> </span><span class="s2">"was"</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span><span class="w"> </span><span class="s2">"is"</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="w"> </span><span class="p">}</span><span class="w">
        </span><span class="p">}</span><span class="w">
      </span><span class="p">}</span><span class="w">
    </span><span class="p">}</span><span class="w">
  </span><span class="p">]</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>
<p>Each change in the <code>events</code> array consists of following objects:</p>

<table><thead>
<tr>
<th>Name</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>event</td>
<td>See <a href="#v2-event">Event model</a></td>
</tr>
<tr>
<td>loyalty_club</td>
<td>Information about member&#39;s Loyalty Club - it&#39;s ID and slug.</td>
</tr>
<tr>
<td>member</td>
<td>Member attributes after the event - See <a href="https://docs.mpc.placewise.com/#introduction36">Member JSON model</a>. For <code>delete</code> events it contains only <code>id</code> and <code>person_id</code></td>
</tr>
<tr>
<td>member_changes</td>
<td>See <a href="#v2-event">Event model</a>. It&#39;s empty for <code>delete</code> events</td>
</tr>
</tbody></table>
<h5 id='a-name-v2-event-a-event-model-1'><span id=a-name-v2-event-a-event-model></span><a name="v2-event"></a> Event model</h5>
<p>Contains meta information about the change event. </p>

<table><thead>
<tr>
<th>Attribute</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>type</td>
<td><code>import</code>, <code>update</code>, or <code>delete</code></td>
<td>A type of the change event</td>
</tr>
<tr>
<td>date</td>
<td>Date</td>
<td>When the event occurred</td>
</tr>
</tbody></table>
<h5 id='a-name-v2-changes-a-changes-object-1'><span id=a-name-v2-changes-a-changes-object></span><a name="v2-changes"></a> Changes object</h5>
<p>Represents changes that happened to member within the event. Includes only properties that have been actually changed
within the event.</p>

<p>Changes object may contain following fields:</p>

<ul>
<li><code>msisdn</code></li>
<li><code>email</code></li>
<li><code>sms_status</code></li>
<li><code>email_status</code></li>
<li><code>push_status</code></li>
<li><code>optin_channel</code></li>
<li><code>optin_subchannel</code></li>
<li><code>consents</code>, which contains changes for consents </li>
<li><code>properties</code>, which contains changes for properties</li>
</ul>

<p>Each change consists of three fields:</p>

<table><thead>
<tr>
<th>Attribute</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>change</td>
<td><code>~</code>, <code>+</code> or <code>-</code></td>
<td>Whether the property has been changed (<code>~</code>), added (<code>+</code>) or removed (<code>-</code>)</td>
</tr>
<tr>
<td>before</td>
<td>mixed</td>
<td>The value of property before the change</td>
</tr>
<tr>
<td>after</td>
<td>mixed</td>
<td>The value of property after the change</td>
</tr>
</tbody></table>
<h4 id='notifications-v1-deprecated-1'><span id=notifications-v1-deprecated></span>Notifications v1 (deprecated)</h4>
<blockquote>
<p>Example for v1</p>
</blockquote>
<pre class="highlight json tab-json"><code><span class="p">{</span><span class="w">
  </span><span class="s2">"version"</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w">
  </span><span class="s2">"bulk"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
    </span><span class="p">{</span><span class="w">
      </span><span class="s2">"customer_name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Infinity Mall"</span><span class="p">,</span><span class="w">
      </span><span class="s2">"customer_id"</span><span class="p">:</span><span class="w"> </span><span class="mi">447</span><span class="p">,</span><span class="w">
      </span><span class="s2">"event_type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"update"</span><span class="p">,</span><span class="w">
      </span><span class="s2">"external_id"</span><span class="p">:</span><span class="w"> </span><span class="mi">44882174</span><span class="p">,</span><span class="w">
      </span><span class="s2">"properties"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="s2">"birthday"</span><span class="p">:{</span><span class="w"> </span><span class="s2">"type"</span><span class="p">:</span><span class="s2">"string"</span><span class="p">,</span><span class="s2">"value"</span><span class="p">:</span><span class="s2">"1990-01-01"</span><span class="w"> </span><span class="p">},</span><span class="w">
        </span><span class="s2">"gender"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="s2">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"string"</span><span class="p">,</span><span class="w"> </span><span class="s2">"value"</span><span class="p">:</span><span class="w"> </span><span class="s2">"woman"</span><span class="w"> </span><span class="p">},</span><span class="w">
        </span><span class="s2">"language"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="s2">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"string"</span><span class="p">,</span><span class="w"> </span><span class="s2">"value"</span><span class="p">:</span><span class="w"> </span><span class="s2">"en"</span><span class="w"> </span><span class="p">},</span><span class="w">
        </span><span class="s2">"first_name"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="s2">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"string"</span><span class="p">,</span><span class="w"> </span><span class="s2">"value"</span><span class="p">:</span><span class="w"> </span><span class="s2">"John"</span><span class="w"> </span><span class="p">},</span><span class="w">
        </span><span class="s2">"last_name"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="s2">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"string"</span><span class="p">,</span><span class="w"> </span><span class="s2">"value"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Doe"</span><span class="w"> </span><span class="p">},</span><span class="w">
        </span><span class="s2">"optin_channel"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="s2">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"string"</span><span class="p">,</span><span class="w"> </span><span class="s2">"value"</span><span class="p">:</span><span class="w"> </span><span class="s2">"webforms"</span><span class="w"> </span><span class="p">},</span><span class="w">
        </span><span class="s2">"msisdn"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="s2">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"string"</span><span class="p">,</span><span class="w"> </span><span class="s2">"value"</span><span class="p">:</span><span class="w"> </span><span class="s2">"4740769126"</span><span class="w"> </span><span class="p">},</span><span class="w">
        </span><span class="s2">"email"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="s2">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"string"</span><span class="p">,</span><span class="w"> </span><span class="s2">"value"</span><span class="p">:</span><span class="w"> </span><span class="s2">"j.doe@example.com"</span><span class="w"> </span><span class="p">},</span><span class="w">
        </span><span class="s2">"sms_status"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="s2">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"string"</span><span class="p">,</span><span class="w"> </span><span class="s2">"value"</span><span class="p">:</span><span class="w"> </span><span class="s2">"verified"</span><span class="w"> </span><span class="p">},</span><span class="w">
        </span><span class="s2">"email_status"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="s2">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"string"</span><span class="p">,</span><span class="w"> </span><span class="s2">"value"</span><span class="p">:</span><span class="w"> </span><span class="s2">"unsubscribed"</span><span class="w"> </span><span class="p">},</span><span class="w">
        </span><span class="s2">"push_status"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="s2">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"string"</span><span class="p">,</span><span class="w"> </span><span class="s2">"value"</span><span class="p">:</span><span class="w"> </span><span class="s2">"enabled"</span><span class="w"> </span><span class="p">}</span><span class="w">
      </span><span class="p">},</span><span class="w">
      </span><span class="s2">"consents"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="s2">"dmp_profiling"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="s2">"value"</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="w"> </span><span class="p">},</span><span class="w">
        </span><span class="s2">"sms_marketing"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="s2">"value"</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="w"> </span><span class="p">},</span><span class="w">
        </span><span class="s2">"email_marketing"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="s2">"value"</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="w"> </span><span class="p">},</span><span class="w">
        </span><span class="s2">"custom_consent"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="s2">"value"</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="w"> </span><span class="p">}</span><span class="w">
      </span><span class="p">},</span><span class="w">
      </span><span class="s2">"created_at"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2018-05-28T08:34:59.231Z"</span><span class="p">,</span><span class="w">
      </span><span class="s2">"optin_date"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2018-05-24T11:23:41.231Z"</span><span class="w">
    </span><span class="p">}</span><span class="w">
  </span><span class="p">]</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>
<p>Each change in the <code>bulk</code> is identified by following attributes:</p>

<table><thead>
<tr>
<th>Attribute</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>customer_name</td>
<td>String</td>
<td>Name of Loyalty Club</td>
</tr>
<tr>
<td>customer_id</td>
<td>Integer</td>
<td>ID of Loyalty Club</td>
</tr>
<tr>
<td>event_type</td>
<td><code>import</code>, <code>update</code>, or <code>delete</code></td>
<td>A type of the change</td>
</tr>
<tr>
<td>external_id</td>
<td>Integer</td>
<td>ID of member</td>
</tr>
<tr>
<td>properties</td>
<td>Object</td>
<td>Member properties. Each of them has a <code>type &lt;String&gt;</code> and <code>value &lt;String&gt;</code>. When <code>event_type</code> is <code>delete</code>, contains only member identifiers (<code>msisdn</code>, <code>email</code>)</td>
</tr>
<tr>
<td>consents</td>
<td>Object</td>
<td>Member consents and their values. Empty when <code>event_type</code> is <code>delete</code>.</td>
</tr>
<tr>
<td>created_at</td>
<td>Date</td>
<td>When the change occurred</td>
</tr>
<tr>
<td>optin_date</td>
<td>Date</td>
<td>When the member has been created</td>
</tr>
</tbody></table>
<h3 id='notifications-delivery-1'><span id=notifications-delivery></span>Notifications delivery</h3>
<p>Your endpoint must return a <code>2xx</code> (<code>200</code> or <code>201</code> preferably) HTTP status code. Only then the notification 
will be treated as delivered.</p>

<p>If your server returns <code>5xx</code> code, the delivery will be treated as failed, and our system will make another attempt later.
On consequent failures, deliveries will be attempted up to 20 days.</p>

<p>If your server returns a <code>4xx</code> code, the delivery will be ignored.</p>
