<h1 id="endpoints-members">Endpoints &bull; Members</h1>

<h2 id="list"><a name="v3-members-index"></a> List</h2>

<blockquote>
<p>Example:</p>
</blockquote>
<pre class="highlight shell tab-shell"><code>curl <span class="s2">"https://bpc-api.boostcom.no/api/v3/loyalty_clubs/infinity-mall/members?per_page=100&amp;page=1&amp;ids[]=1&amp;ids[]=2"</span> <span class="se">\</span>
  -H <span class="s1">'Content-Type: application/json'</span> <span class="se">\</span>
  -H <span class="s1">'X-Client-Authorization: B7t9U9tsoWsGhrv2ouUoSqpM'</span> <span class="se">\</span>
  -H <span class="s1">'X-Product-Name: default'</span> <span class="se">\</span>
  -H <span class="s1">'X-User-Agent: CURL manual test'</span>
</code></pre>
<blockquote>
<p>Returns hash structured like this:</p>
</blockquote>
<pre class="highlight json tab-json"><code><span class="p">{</span><span class="w">
  </span><span class="s2">"members"</span><span class="p">:</span><span class="w"> </span><span class="p">[],</span><span class="w"> </span><span class="err">//</span><span class="w"> </span><span class="err">List</span><span class="w"> </span><span class="err">of</span><span class="w"> </span><span class="err">members</span><span class="w"> </span><span class="err">-</span><span class="w"> </span><span class="err">See</span><span class="p">:</span><span class="w"> </span><span class="s2">"General Info -&gt; Member JSON model"</span><span class="w">
  </span><span class="s2">"pagination_info"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="s2">"total_count"</span><span class="p">:</span><span class="w"> </span><span class="mi">2050</span><span class="p">,</span><span class="w">
    </span><span class="s2">"per_page"</span><span class="p">:</span><span class="w"> </span><span class="mi">1000</span><span class="p">,</span><span class="w">
    </span><span class="s2">"total_pages"</span><span class="p">:</span><span class="w"> </span><span class="mi">3</span><span class="p">,</span><span class="w">
    </span><span class="s2">"current_page"</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w">
    </span><span class="s2">"next_page"</span><span class="p">:</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w">
    </span><span class="s2">"prev_page"</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span><span class="w">
    </span><span class="s2">"is_first_page"</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span><span class="w">
    </span><span class="s2">"is_last_page"</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span><span class="w">
    </span><span class="s2">"is_out_of_range"</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="w">
  </span><span class="p">}</span><span class="w">  
</span><span class="p">}</span><span class="w">

</span></code></pre>
<p><strong>GET</strong> <code class="prettyprint">api/v3/loyalty_clubs/:loyalty_club_slug/members?per_page=:per_page&amp;page=:page&amp;ids[]=1&amp;ids[]=2</code></p>

<p>Returns paginated list of all Loyalty Club members, sorted by <code class="prettyprint">created_at ASC</code>.</p>

<p>Every returned member is represented by <a href="#v3-member-model">Member model</a>.</p>

<h3 id="query-parameters">Query Parameters</h3>

<table><thead>
<tr>
<th>Parameter</th>
<th>Type</th>
<th>Required?</th>
<th>Default</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>per_page</td>
<td>integer</td>
<td>no</td>
<td>1000</td>
<td>Number of results to be returned per request (1000 is the maximum)</td>
</tr>
<tr>
<td>page_no</td>
<td>integer</td>
<td>no</td>
<td>1</td>
<td>Number of results page</td>
</tr>
<tr>
<td>ids</td>
<td>Array<integer></td>
<td>no</td>
<td>null</td>
<td>IDs of members to return</td>
</tr>
</tbody></table>

<h3 id="response-json-object">Response (JSON object)</h3>

<table><thead>
<tr>
<th>Key</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>members</td>
<td>Array<Member></td>
<td>Array of <a href="#v3-member-model">Members</a></td>
</tr>
<tr>
<td>pagination_info</td>
<td>Object</td>
<td></td>
</tr>
<tr>
<td>pagination_info[&lsquo;total_count&rsquo;]</td>
<td>integer</td>
<td>Number of all available results</td>
</tr>
<tr>
<td>pagination_info[&lsquo;per_page&rsquo;]</td>
<td>integer</td>
<td>Number of results returned per request</td>
</tr>
<tr>
<td>pagination_info[&lsquo;total_pages&rsquo;]</td>
<td>integer</td>
<td>Number of all available pages</td>
</tr>
<tr>
<td>pagination_info[&lsquo;current_page&rsquo;]</td>
<td>integer</td>
<td></td>
</tr>
<tr>
<td>pagination_info[&lsquo;next_page&rsquo;]</td>
<td>integer</td>
<td>Next available page (<code class="prettyprint">null</code> when it&rsquo;s a last page)</td>
</tr>
<tr>
<td>pagination_info[&lsquo;prev_page&rsquo;]</td>
<td>integer</td>
<td>Previous available page (<code class="prettyprint">null</code> when it&rsquo;s a first page)</td>
</tr>
<tr>
<td>pagination_info[&lsquo;is_first_page&rsquo;]</td>
<td>integer</td>
<td></td>
</tr>
<tr>
<td>pagination_info[&lsquo;is_last_page&rsquo;]</td>
<td>boolean</td>
<td></td>
</tr>
<tr>
<td>pagination_info[&lsquo;is_out_of_range&rsquo;]</td>
<td>boolean</td>
<td>Is given <code class="prettyprint">per_page</code> param out of range?</td>
</tr>
</tbody></table>

<aside class="notice">
Requires <code>BL:Api:Members:Index</code> permit
</aside>

<h3 id="error-responses">Error responses</h3>

<table><thead>
<tr>
<th>Status</th>
<th>Reason</th>
</tr>
</thead><tbody>
<tr>
<td><code class="prettyprint">400</code></td>
<td>:per_page param exceeds the limit</td>
</tr>
</tbody></table>

<!--- ############################################################################################################# --->

<h2 id="get-public-info"><a name="v3-members-public-info"></a> Get public info</h2>

<blockquote>
<p>Example:</p>
</blockquote>
<pre class="highlight shell tab-shell"><code>curl <span class="s2">"https://bpc-api.boostcom.no/api/v3/loyalty_clubs/infinity-mall/members/:id/public_info"</span> <span class="se">\</span>
  -H <span class="s1">'Content-Type: application/json'</span> <span class="se">\</span>
  -H <span class="s1">'X-Client-Authorization: B7t9U9tsoWsGhrv2ouUoSqpM'</span> <span class="se">\</span>
  -H <span class="s1">'X-Product-Name: default'</span> <span class="se">\</span>
  -H <span class="s1">'X-User-Agent: CURL manual test'</span>
</code></pre>
<blockquote>
<p>Returns hash structured like this:</p>
</blockquote>
<pre class="highlight json tab-json"><code><span class="p">{</span><span class="w">
  </span><span class="s2">"exists"</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span><span class="w"> 
  </span><span class="s2">"can_login"</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="w"> 
</span><span class="p">}</span><span class="w">
</span></code></pre>
<p><strong>GET</strong> <code class="prettyprint">api/v3/loyalty_clubs/:loyalty_club_slug/members/:id/public_info</code></p>

<p><strong>GET</strong> <code class="prettyprint">api/v3/loyalty_clubs/:loyalty_club_slug/members/by_msisdn/:msisdn/public_info</code></p>

<p><strong>GET</strong> <code class="prettyprint">api/v3/loyalty_clubs/:loyalty_club_slug/members/by_email/:email/public_info</code></p>

<p>Returns basic info for given member. If member does not exist, returns `null&rsquo;.</p>

<h3 id="url-parameters">URL Parameters</h3>

<table><thead>
<tr>
<th>Parameter</th>
<th>Description</th>
<th>Type</th>
</tr>
</thead><tbody>
<tr>
<td>id</td>
<td>Member&rsquo;s ID</td>
<td>integer</td>
</tr>
<tr>
<td>msisdn</td>
<td>Member&rsquo;s msisdn</td>
<td>string (format as defined <a href="#msisdn-member-identifier">here</a> - example: <code class="prettyprint">4740485124</code>)</td>
</tr>
<tr>
<td>email</td>
<td>Member&rsquo;s email</td>
<td>string (email)</td>
</tr>
</tbody></table>

<h3 id="response-json-object">Response (JSON object)</h3>

<table><thead>
<tr>
<th>Key</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>exists</td>
<td>boolean</td>
<td>Does member with given identifier exist in given Loyalty Club?</td>
</tr>
<tr>
<td>can_login</td>
<td>boolean</td>
<td>Is this member able to sign?</td>
</tr>
</tbody></table>

<aside class="notice">
Requires <code>BL:Api:Members:Check</code> permit
</aside>

<h3 id="error-responses">Error responses</h3>

<table><thead>
<tr>
<th>Status</th>
<th>Reason</th>
</tr>
</thead><tbody>
<tr>
<td><code class="prettyprint">422</code></td>
<td>Invalid MSISDN param</td>
</tr>
</tbody></table>

<!--- ############################################################################################################# --->

<h2 id="get-person-id"><a name="v3-members-person-id"></a> Get person id</h2>

<blockquote>
<p>Example:</p>
</blockquote>
<pre class="highlight shell tab-shell"><code>curl <span class="s2">"https://bpc-api.boostcom.no/api/v3/loyalty_clubs/infinity-mall/members/:id/person_id"</span> <span class="se">\</span>
  -H <span class="s1">'Content-Type: application/json'</span> <span class="se">\</span>
  -H <span class="s1">'X-Client-Authorization: B7t9U9tsoWsGhrv2ouUoSqpM'</span> <span class="se">\</span>
  -H <span class="s1">'X-Product-Name: default'</span> <span class="se">\</span>
  -H <span class="s1">'X-User-Agent: CURL manual test'</span>
</code></pre>
<blockquote>
<p>Returns hash structured like this:</p>
</blockquote>
<pre class="highlight json tab-json"><code><span class="p">{</span><span class="w">
  </span><span class="s2">"source"</span><span class="p">:</span><span class="w"> </span><span class="s2">"storage"</span><span class="p">,</span><span class="w"> 
  </span><span class="s2">"person_id"</span><span class="p">:</span><span class="w"> </span><span class="mi">92</span><span class="w"> 
</span><span class="p">}</span><span class="w">
</span></code></pre>
<p><strong>GET</strong> <code class="prettyprint">api/v3/loyalty_clubs/:loyalty_club_slug/members/:id/person_id</code></p>

<p><strong>GET</strong> <code class="prettyprint">api/v3/loyalty_clubs/:loyalty_club_slug/members/by_msisdn/:msisdn/person_id</code></p>

<p><strong>GET</strong> <code class="prettyprint">api/v3/loyalty_clubs/:loyalty_club_slug/members/by_email/:email/person_id</code></p>

<p>Returns <code class="prettyprint">person_id</code> for given member. Please note that <code class="prettyprint">person_id</code> cannot be preset in member payload and will be silently ignored. Also, it cannot be updated.</p>

<blockquote>
<p>There are 3 possible successful responses:</p>

<p>If member currently exists in database:</p>
</blockquote>
<pre class="highlight json tab-json"><code><span class="p">{</span><span class="w">
  </span><span class="s2">"success"</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span><span class="w">
  </span><span class="s2">"source"</span><span class="p">:</span><span class="w"> </span><span class="s2">"db"</span><span class="p">,</span><span class="w"> 
  </span><span class="s2">"person_id"</span><span class="p">:</span><span class="w"> </span><span class="mi">92</span><span class="w"> 
</span><span class="p">}</span><span class="w">
</span></code></pre>
<blockquote>
<p>If member does not exist but was deleted in last 30 days:</p>
</blockquote>
<pre class="highlight json tab-json"><code><span class="p">{</span><span class="w">
  </span><span class="s2">"success"</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span><span class="w">
  </span><span class="s2">"source"</span><span class="p">:</span><span class="w"> </span><span class="s2">"storage"</span><span class="p">,</span><span class="w"> 
  </span><span class="s2">"person_id"</span><span class="p">:</span><span class="w"> </span><span class="mi">92</span><span class="w"> 
</span><span class="p">}</span><span class="w">
</span></code></pre>
<blockquote>
<p>If member does not exist and never existed or did not exist in last 30 days:</p>
</blockquote>
<pre class="highlight json tab-json"><code><span class="p">{</span><span class="w">
  </span><span class="s2">"success"</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span><span class="w">
  </span><span class="s2">"source"</span><span class="p">:</span><span class="w"> </span><span class="s2">"not_found"</span><span class="p">,</span><span class="w"> 
  </span><span class="s2">"person_id"</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="w"> 
</span><span class="p">}</span><span class="w">
</span></code></pre>
<h3 id="url-parameters">URL Parameters</h3>

<table><thead>
<tr>
<th>Parameter</th>
<th>Description</th>
<th>Type</th>
</tr>
</thead><tbody>
<tr>
<td>id</td>
<td>Member&rsquo;s ID</td>
<td>integer</td>
</tr>
<tr>
<td>msisdn</td>
<td>Member&rsquo;s msisdn</td>
<td>string (format as defined <a href="#msisdn-member-identifier">here</a> - example: <code class="prettyprint">4740485124</code>)</td>
</tr>
<tr>
<td>email</td>
<td>Member&rsquo;s email</td>
<td>string (email)</td>
</tr>
</tbody></table>

<h3 id="response-json-object">Response (JSON object)</h3>

<table><thead>
<tr>
<th>Key</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>success</td>
<td>boolean</td>
<td>If query was successful?</td>
</tr>
<tr>
<td>source</td>
<td>string</td>
<td>Source of <code class="prettyprint">person_id</code> (possible values are: <code class="prettyprint">not_found</code>, <code class="prettyprint">db</code>, <code class="prettyprint">storage</code>)</td>
</tr>
<tr>
<td>person_id</td>
<td>integer</td>
<td>Member&rsquo;s <code class="prettyprint">person_id</code></td>
</tr>
</tbody></table>

<aside class="notice">
Requires <code>BL:Api:Members:Check</code> permit
</aside>

<h3 id="error-responses">Error responses</h3>

<table><thead>
<tr>
<th>Status</th>
<th>Reason</th>
</tr>
</thead><tbody>
<tr>
<td><code class="prettyprint">422</code></td>
<td>Invalid MSISDN param</td>
</tr>
</tbody></table>

<!--- ############################################################################################################# --->

<h2 id="get"><a name="v3-members-get"></a> Get</h2>

<blockquote>
<p>Example:</p>
</blockquote>
<pre class="highlight shell tab-shell"><code>curl <span class="s2">"https://bpc-api.boostcom.no/api/v3/loyalty_clubs/infinity-mall/members/:id"</span> <span class="se">\</span>
  -H <span class="s1">'Content-Type: application/json'</span> <span class="se">\</span>
  -H <span class="s1">'X-Client-Authorization: B7t9U9tsoWsGhrv2ouUoSqpM'</span> <span class="se">\</span>
  -H <span class="s1">'X-Product-Name: default'</span> <span class="se">\</span>
  -H <span class="s1">'X-User-Agent: CURL manual test'</span>
</code></pre>
<blockquote>
<p>When successful, the above command returns member object as depicted <a href="#v3-member-model">here</a></p>
</blockquote>

<p><strong>GET</strong> <code class="prettyprint">api/v3/loyalty_clubs/:loyalty_club_slug/members/:id</code></p>

<p><strong>GET</strong> <code class="prettyprint">api/v3/loyalty_clubs/:loyalty_club_slug/members/by_msisdn/:msisdn</code></p>

<p><strong>GET</strong> <code class="prettyprint">api/v3/loyalty_clubs/:loyalty_club_slug/members/by_email/:email</code></p>

<p>Returns member by one of three identifier types: <code class="prettyprint">id</code>, <code class="prettyprint">member</code> or <code class="prettyprint">email</code></p>

<h3 id="url-parameters">URL Parameters</h3>

<table><thead>
<tr>
<th>Parameter</th>
<th>Description</th>
<th>Type</th>
</tr>
</thead><tbody>
<tr>
<td>id</td>
<td>Member&rsquo;s ID</td>
<td>integer</td>
</tr>
<tr>
<td>msisdn</td>
<td>Member&rsquo;s msisdn</td>
<td>string (format as defined <a href="#msisdn-member-identifier">here</a> - example: <code class="prettyprint">4740485124</code>)</td>
</tr>
<tr>
<td>email</td>
<td>Member&rsquo;s email</td>
<td>string (email)</td>
</tr>
</tbody></table>

<h3 id="response-json-object">Response (JSON object)</h3>

<p>See: <a href="#v3-member-model">Member model</a></p>

<h3 id="error-responses">Error responses</h3>

<table><thead>
<tr>
<th>Status</th>
<th>Reason</th>
</tr>
</thead><tbody>
<tr>
<td><code class="prettyprint">404</code></td>
<td>Member with given identifier could not found</td>
</tr>
<tr>
<td><code class="prettyprint">422</code></td>
<td>Invalid MSISDN param</td>
</tr>
</tbody></table>

<aside class="notice">
Requires <code>BL:Api:Members:Get</code> permit
</aside>

<!--- ############################################################################################################# --->

<h2 id="create"><a name="v3-members-create"></a> Create</h2>

<blockquote>
<p>Example:</p>
</blockquote>
<pre class="highlight shell tab-shell"><code>
curl -X POST <span class="se">\</span>
  https://bpc-api.boostcom.no/api/v3/loyalty_clubs/infinity-mall/members <span class="se">\</span>
  -H <span class="s1">'Content-Type: application/json'</span> <span class="se">\</span>
  -H <span class="s1">'X-Client-Authorization: B7t9U9tsoWsGhrv2ouUoSqpM'</span> <span class="se">\</span>
  -H <span class="s1">'X-Product-Name: facebook'</span> <span class="se">\</span>
  -H <span class="s1">'X-Subproduct-Name: campaign-10-2017'</span> <span class="se">\</span>
  -H <span class="s1">'X-User-Agent: CURL manual test'</span> <span class="se">\</span>
  -d <span class="s1">'{
    "properties": {
        "email": "dev+6@test.com",
        "msisdn": "4740485124",
        "first_name": "The",
        "last_name": "Doge"
    },
    "consents": {
        "consent1": { status: true },
        "consent2": { status: false }
    },
    "send_sms_welcome_message": false
}'</span>

</code></pre>
<blockquote>
<p>When successful, the above command returns created member object as depicted <a href="#v3-member-model">here</a></p>

<p>When payload is invalid, validation errors like this are returned:</p>
</blockquote>
<pre class="highlight json tab-json"><code><span class="p">{</span><span class="w">
    </span><span class="s2">"email"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
        </span><span class="p">{</span><span class="w">

            </span><span class="s2">"property"</span><span class="p">:</span><span class="w"> </span><span class="s2">"email"</span><span class="p">,</span><span class="w">
            </span><span class="s2">"error"</span><span class="p">:</span><span class="w"> </span><span class="s2">"duplicated_email_in_community"</span><span class="w">
        </span><span class="p">}</span><span class="w">
    </span><span class="p">]</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>
<p><strong>POST</strong> <code class="prettyprint">api/v3/loyalty_clubs/:loyalty_club_slug/members</code></p>

<p>Create member with given properties.</p>

<p>Available properties and their validation rules are defined by Loyalty Club schema (see: <a href="#v3-loyalty-clubs-schema">here</a>).</p>

<p>Actual welcome messages sending depends on Loyalty Club and Product configuration.
For example, even if send_email_welcome_message:true param is provided, message may not be sent because either Product 
or Loyalty has disabled welcome messages or Loyalty Club has no e-mails configured at all.</p>

<p>There is also a possibility to have multiple SMS welcome messages sent. The one that matches Product or default one will be sent.</p>

<h3 id="registration-password"><a name="v3-members-create-registration-password"></a> Registration Password</h3>

<p>Some API clients (depends on Permit assigned to given <code class="prettyprint">X-Client-Authorization</code> token) may be required to provide 
valid <code class="prettyprint">registration_password</code> param that is sent to user with <a href="#v3-members-send-registration-password">Members &bull; Send registration password</a> </p>

<h3 id="headers">Headers</h3>

<table><thead>
<tr>
<th>Header name</th>
<th>Required?</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>X-Subproduct-Name</td>
<td>no</td>
<td>Additional source/optin channel information</td>
</tr>
</tbody></table>

<h3 id="post-parameters-json">POST Parameters (JSON)</h3>

<table><thead>
<tr>
<th>Parameter</th>
<th>Required?</th>
<th>Default</th>
<th>Description</th>
<th>Type</th>
</tr>
</thead><tbody>
<tr>
<td>properties</td>
<td><strong>yes</strong></td>
<td>none</td>
<td>JSON with properties for member</td>
<td>JSON Object</td>
</tr>
<tr>
<td>properties[&lsquo;language&rsquo;]</td>
<td>no</td>
<td>&ldquo;default_language&rdquo; from schema</td>
<td>Language used by user</td>
<td>string</td>
</tr>
<tr>
<td>properties[&lsquo;msisdn&rsquo;]</td>
<td>yes*</td>
<td>none</td>
<td>Unique member&rsquo;s msisdn as defined <a href="#msisdn-member-identifier">here</a>) Example: <code class="prettyprint">4740485124</code>.</td>
<td>string</td>
</tr>
<tr>
<td>properties[&lsquo;email&rsquo;]</td>
<td>yes*</td>
<td>none</td>
<td>Member&rsquo;s email</td>
<td>string</td>
</tr>
<tr>
<td>consents</td>
<td>no</td>
<td>{}</td>
<td>Member&rsquo;s consents (similar to <a href="#v3-member-consents-model">Member&rsquo;s consents JSON model</a>)</td>
<td>JSON Object</td>
</tr>
<tr>
<td>password</td>
<td>no</td>
<td>none</td>
<td>Member&rsquo;s password. Not required, but user won&rsquo;t be able to log in without this</td>
<td>string</td>
</tr>
<tr>
<td>sms_enabled</td>
<td>no</td>
<td>true</td>
<td>Should SMS channel be enabled for member?</td>
<td>Boolean</td>
</tr>
<tr>
<td>email_enabled</td>
<td>no</td>
<td>true</td>
<td>Should email channel be enabled for member?</td>
<td>Boolean</td>
</tr>
<tr>
<td>push_enabled</td>
<td>no</td>
<td>true</td>
<td>Should push channel will be enabled for member?</td>
<td>Boolean</td>
</tr>
<tr>
<td>send_sms_welcome_message</td>
<td>no</td>
<td>true</td>
<td>Should SMS welcome message be sent to member?</td>
<td>Boolean</td>
</tr>
<tr>
<td>send_email_welcome_message</td>
<td>no</td>
<td>true</td>
<td>Should email welcome be sent to member</td>
<td>Boolean</td>
</tr>
<tr>
<td>registration_password</td>
<td>depends</td>
<td>none</td>
<td>Password for registration for member MSISDN verification, see <a href="#v3-members-create-registration-password">above</a></td>
<td></td>
</tr>
</tbody></table>

<p>&ast; At least one of those properties must be provided</p>

<h3 id="response-json-object">Response (JSON object)</h3>

<p>Created member properties - see: <a href="#v3-member-model">Member model</a></p>

<h3 id="error-responses">Error responses</h3>

<table><thead>
<tr>
<th>Status</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td><code class="prettyprint">422</code></td>
<td><a href="#validation-on-members">validation errors</a> JSON object.</td>
</tr>
<tr>
<td><code class="prettyprint">465</code></td>
<td><code class="prettyprint">registration_password</code> param is missing</td>
</tr>
<tr>
<td><code class="prettyprint">466</code></td>
<td><code class="prettyprint">registration_password</code> param is invalid</td>
</tr>
</tbody></table>

<aside class="notice">
Requires <code>BL:Api:Members:Create</code> or <code>BL:Api:Members:CreateWithVerification</code>permit
</aside>

<!--- ############################################################################################################# --->

<h2 id="update"><a name="v3-members-update"></a> Update</h2>

<blockquote>
<p>Example:</p>
</blockquote>
<pre class="highlight shell tab-shell"><code>
curl -X PUT <span class="se">\</span>
  https://bpc-api.boostcom.no/api/v3/loyalty_clubs/infinity-mall/members/:id <span class="se">\</span>
  -H <span class="s1">'Content-Type: application/json'</span> <span class="se">\</span>
  -H <span class="s1">'X-Client-Authorization: B7t9U9tsoWsGhrv2ouUoSqpM'</span> <span class="se">\</span>
  -H <span class="s1">'X-Product-Name: default'</span> <span class="se">\</span>
  -H <span class="s1">'X-User-Agent: CURL manual test'</span> <span class="se">\</span>
  -d <span class="se">\</span>
  <span class="s1">'{
    "properties": {
      "last_name": "Doge"
    },
    "password": "new_password"
  }'</span>
</code></pre>
<blockquote>
<p>When successful, the above command returns updated member object as depicted <a href="#v3-member-model">here</a></p>

<p>When payload is invalid, validation errors as depicted <a href="#v3-members-create">here</a></p>
</blockquote>

<p><strong>PUT</strong> <code class="prettyprint">api/v3/loyalty_clubs/:loyalty_club_slug/members/:id</code></p>

<p>Update member&rsquo;s properties, consents and other with given ones.</p>

<p>It is intended for partial updates:
* not given properties are neither deleted nor overwritten,
* not given attributes (like consents) won&rsquo;t be changed in any way.</p>

<p>If deleting properties is intended, their value should be sent as <code class="prettyprint">null</code>.</p>

<p>This endpoint may return validation errors (<code class="prettyprint">422</code>) even for current member properties. 
That&rsquo;s because loyalty club schema may get changed over time which results in invalidating existing users.</p>

<p>To bypass such validation errors, you may provide <code class="prettyprint">validate_partially: true</code> param which will validate and update only 
attributes that were provided in payload. </p>

<h3 id="url-parameters">URL Parameters</h3>

<table><thead>
<tr>
<th>Parameter</th>
<th>Description</th>
<th>Type</th>
</tr>
</thead><tbody>
<tr>
<td>id</td>
<td>Member&rsquo;s ID</td>
<td>integer</td>
</tr>
</tbody></table>

<h3 id="put-parameters-json">PUT Parameters (JSON)</h3>

<table><thead>
<tr>
<th>Parameter</th>
<th>Description</th>
<th>Type</th>
<th>Default</th>
</tr>
</thead><tbody>
<tr>
<td>properties</td>
<td>JSON with properties for member</td>
<td>JSON Object</td>
<td>null</td>
</tr>
<tr>
<td>consents</td>
<td>Member&rsquo;s consents (similar to <a href="#v3-member-consents-model">Member&rsquo;s consents JSON model</a>)</td>
<td>JSON Object</td>
<td>null</td>
</tr>
<tr>
<td>password</td>
<td>Member&rsquo;s password</td>
<td>string</td>
<td>null</td>
</tr>
<tr>
<td>sms_enabled</td>
<td>Should SMS channel be enabled for member?</td>
<td>Boolean</td>
<td>null</td>
</tr>
<tr>
<td>email_enabled</td>
<td>Should email channel be enabled for member?</td>
<td>Boolean</td>
<td>null</td>
</tr>
<tr>
<td>push_enabled</td>
<td>Should push channel will be enabled for member?</td>
<td>Boolean</td>
<td>null</td>
</tr>
<tr>
<td>validate_partially</td>
<td>Should only provided data be validated?</td>
<td>Boolean</td>
<td>false</td>
</tr>
</tbody></table>

<h3 id="response-json-object">Response (JSON object)</h3>

<p>Member properties after update - see: <a href="#v3-member-model">Member model</a></p>

<h3 id="error-responses">Error responses</h3>

<table><thead>
<tr>
<th>Status</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td><code class="prettyprint">404</code></td>
<td>Member could not be found</td>
</tr>
<tr>
<td><code class="prettyprint">422</code></td>
<td><a href="#validation-on-members">validation errors</a> JSON object.</td>
</tr>
</tbody></table>

<aside class="notice">
Requires <code>BL:Api:Members:Update</code> permit
</aside>

<!--- ############################################################################################################# --->

<h2 id="destroy"><a name="v3-members-destroy"></a> Destroy</h2>

<p><strong>DELETE</strong> <code class="prettyprint">api/v3/loyalty_clubs/:loyalty_club_slug/members/:id</code></p>

<p>Permanently removes member.</p>

<p>It is possible to trigger optout message by setting <code class="prettyprint">send_unsubscribe_message=true</code> query string parameter.
Same as welcome messages, optout messages sending also depends on Loyalty Club and Product configuration.</p>

<blockquote>
<p>Example:</p>
</blockquote>
<pre class="highlight shell tab-shell"><code>curl -X DELETE <span class="se">\</span>
    <span class="s2">"https://bpc-api.boostcom.no/api/v3/loyalty_clubs/infinity-mall/members/:id"</span> <span class="se">\</span>
    -H <span class="s1">'Content-Type: application/json'</span> <span class="se">\</span>
    -H <span class="s1">'X-Client-Authorization: B7t9U9tsoWsGhrv2ouUoSqpM'</span> <span class="se">\</span>
    -H <span class="s1">'X-Product-Name: default'</span> <span class="se">\</span>
    -H <span class="s1">'X-User-Agent: CURL manual test'</span>
</code></pre>
<blockquote>
<p>When successful, the above command returns destroyed member object as depicted <a href="#v3-member-model">here</a></p>
</blockquote>

<h3 id="url-parameters">URL Parameters</h3>

<table><thead>
<tr>
<th>Parameter</th>
<th>Description</th>
<th>Type</th>
</tr>
</thead><tbody>
<tr>
<td>id</td>
<td>Member&rsquo;s ID</td>
<td>integer</td>
</tr>
</tbody></table>

<h3 id="query-parameters">Query Parameters</h3>

<table><thead>
<tr>
<th>Parameter</th>
<th>Required?</th>
<th>Default</th>
<th>Description</th>
<th>Type</th>
</tr>
</thead><tbody>
<tr>
<td>send_email_unsubscribe_message</td>
<td>no</td>
<td>true</td>
<td>Should optout email be sent to member?</td>
<td>Boolean</td>
</tr>
</tbody></table>

<h3 id="response-json-object">Response (JSON object)</h3>

<p>Properties of member that has been destroyed - see: <a href="#v3-member-model">Member model</a></p>

<h3 id="error-responses">Error responses</h3>

<table><thead>
<tr>
<th>Status</th>
<th>Reason</th>
</tr>
</thead><tbody>
<tr>
<td><code class="prettyprint">404</code></td>
<td>Member could not be found</td>
</tr>
<tr>
<td><code class="prettyprint">422</code></td>
<td><a href="#validation-on-members">validation errors</a> JSON object.</td>
</tr>
</tbody></table>

<aside class="notice">
Requires <code>BL:Api:Members:Destroy</code> permit
</aside>

<!--- ############################################################################################################# --->

<h2 id="reset-password"><a name="v3-members-reset-password"></a> Reset password</h2>

<blockquote>
<p>Example:</p>
</blockquote>
<pre class="highlight shell tab-shell"><code>curl -X PUT <span class="se">\</span>
  <span class="s2">"https://bpc-api.boostcom.no/api/v3/loyalty_clubs/:loyalty_club_slug/members/by_email/:email/reset_password"</span> <span class="se">\</span>
  -H <span class="s1">'Content-Type: application/json'</span> <span class="se">\</span>
  -H <span class="s1">'X-Client-Authorization: B7t9U9tsoWsGhrv2ouUoSqpM'</span> <span class="se">\</span>
  -H <span class="s1">'X-Product-Name: default'</span> <span class="se">\</span>
  -H <span class="s1">'X-User-Agent: CURL manual test'</span> <span class="se">\</span>
  -d <span class="se">\</span>
    <span class="s1">'{
      "password": "new_password",
      "token": "k4wort03j2"
    }'</span>
</code></pre>
<blockquote>
<p>When successful, returns an empty object:</p>
</blockquote>
<pre class="highlight json tab-json"><code><span class="p">{</span><span class="w">
  </span><span class="err">//</span><span class="w"> </span><span class="err">Empty</span><span class="w"> </span><span class="err">object</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>
<p><strong>PUT</strong> <code class="prettyprint">/api/v3/loyalty_clubs/:loyalty_club_slug/members/by_email/:email/reset_password</code></p>

<p>Updates given member password if token is valid.</p>

<h3 id="url-parameters">URL Parameters</h3>

<table><thead>
<tr>
<th>Parameter</th>
<th>Description</th>
<th>Type</th>
</tr>
</thead><tbody>
<tr>
<td>password</td>
<td>Member&rsquo;s new password</td>
<td>string</td>
</tr>
<tr>
<td>token</td>
<td>Confirmation token generated and sent with <a href="#v3-members-send-password-reset-token">Members &bull; Send password reset token</a></td>
<td>string</td>
</tr>
</tbody></table>

<h3 id="error-responses">Error responses</h3>

<table><thead>
<tr>
<th>Status</th>
<th>Reason</th>
</tr>
</thead><tbody>
<tr>
<td><code class="prettyprint">400</code></td>
<td><code class="prettyprint">password</code> or <code class="prettyprint">token</code> param is missing</td>
</tr>
<tr>
<td><code class="prettyprint">404</code></td>
<td>Member could not be found</td>
</tr>
<tr>
<td><code class="prettyprint">422</code></td>
<td>Invalid password - returns <a href="#validation-on-members">validation errors</a> JSON object.</td>
</tr>
<tr>
<td><code class="prettyprint">463</code></td>
<td>Invalid confirmation token</td>
</tr>
</tbody></table>

<aside class="notice">
Requires <code>BL:Api:Members:ResetPassword</code> permit
</aside>

<!--- ############################################################################################################# --->

<h2 id="send-password-reset-token"><a name="v3-members-send-password-reset-token"></a> Send password reset token</h2>

<blockquote>
<p>Example:</p>
</blockquote>
<pre class="highlight shell tab-shell"><code>curl <span class="s2">"https://bpc-api.boostcom.no/api/v3/loyalty_clubs/infinity-mall/members/by_email/joe@example.com/send_password_reset_token"</span> <span class="se">\</span>
  -H <span class="s1">'Content-Type: application/json'</span> <span class="se">\</span>
  -H <span class="s1">'X-Client-Authorization: B7t9U9tsoWsGhrv2ouUoSqpM'</span> <span class="se">\</span>
  -H <span class="s1">'X-Product-Name: default'</span> <span class="se">\</span>
  -H <span class="s1">'X-User-Agent: CURL manual test'</span>
</code></pre>
<blockquote>
<p>Always returns an empty JSON object</p>
</blockquote>
<pre class="highlight json tab-json"><code><span class="p">{</span><span class="w">
  </span><span class="err">//</span><span class="w"> </span><span class="err">Empty</span><span class="w"> </span><span class="err">object</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>
<p><strong>POST</strong> <code class="prettyprint">/api/v3/loyalty_clubs/:loyalty_club_slug/members/by_email/:email/send_password_reset_token</code></p>

<p>Sends password reset link to given e-mail address if it is associated with member in given loyalty club.</p>

<p>The e-mail contains a token generated for member, valid for 24 hours.</p>

<p>The token can be then used to reset password with <a href="#v3-members-reset-password">Members &bull; Reset password</a>.
It also may be verified with <a href="#v3-members-verify-token">Members &bull; Verify token</a></p>

<h3 id="url-parameters">URL Parameters</h3>

<table><thead>
<tr>
<th>Parameter</th>
<th>Description</th>
<th>Type</th>
</tr>
</thead><tbody>
<tr>
<td>email</td>
<td>Member&rsquo;s email</td>
<td>string (email)</td>
</tr>
</tbody></table>

<aside class="notice">
Requires <code>BL:Api:Members:Tokens:Create</code> permit
</aside>

<!--- ############################################################################################################# --->

<h2 id="send-one-time-password-sms"><a name="v3-members-send-one-time-password"></a> Send one time password SMS</h2>

<blockquote>
<p>Example:</p>
</blockquote>
<pre class="highlight shell tab-shell"><code>curl <span class="s2">"https://bpc-api.boostcom.no/api/v3/loyalty_clubs/infinity-mall/members/by_msisdn/4740485124/send_one_time_password"</span> <span class="se">\</span>
  -H <span class="s1">'Content-Type: application/json'</span> <span class="se">\</span>
  -H <span class="s1">'X-Client-Authorization: B7t9U9tsoWsGhrv2ouUoSqpM'</span> <span class="se">\</span>
  -H <span class="s1">'X-Product-Name: default'</span> <span class="se">\</span>
  -H <span class="s1">'X-User-Agent: CURL manual test'</span>
</code></pre>
<blockquote>
<p>Always returns an empty JSON object</p>
</blockquote>
<pre class="highlight json tab-json"><code><span class="p">{</span><span class="w">
  </span><span class="err">//</span><span class="w"> </span><span class="err">Empty</span><span class="w"> </span><span class="err">object</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>
<p><strong>POST</strong> <code class="prettyprint">/api/v3/loyalty_clubs/:loyalty_club_slug/members/by_msisdn/:msisdn/send_one_time_password</code></p>

<p>Sends an SMS to given msisdn if it is associated with member in given loyalty club.</p>

<p>The SMS contains 4-digit One-Time-Password generated for member, valid for 1 hour.</p>

<p>This password then can be used to sign in, just as &ldquo;regular&rdquo; member password - see:  <a href="#v3-token-create">OAuth Token &bull; Create</a>.</p>

<h3 id="url-parameters">URL Parameters</h3>

<table><thead>
<tr>
<th>Parameter</th>
<th>Description</th>
<th>Type</th>
</tr>
</thead><tbody>
<tr>
<td>msisdn</td>
<td>Member&rsquo;s msisdn</td>
<td>string (format as defined <a href="#msisdn-member-identifier">here</a> - example: <code class="prettyprint">4740485124</code>)</td>
</tr>
</tbody></table>

<aside class="notice">
Requires <code>BL:Api:Members:CreateOneTimePassword</code> permit
</aside>

<!--- ############################################################################################################# --->

<h2 id="send-one-time-password-e-mail-wip"><a name="v3-members-send-one-time-password-email"></a> Send one time password E-mail (WIP)</h2>

<blockquote>
<p>Example:</p>
</blockquote>
<pre class="highlight shell tab-shell"><code>curl <span class="s2">"https://bpc-api.boostcom.no/api/v3/loyalty_clubs/infinity-mall/members/by_email/user@example.com/send_one_time_password"</span> <span class="se">\</span>
  -H <span class="s1">'Content-Type: application/json'</span> <span class="se">\</span>
  -H <span class="s1">'X-Client-Authorization: B7t9U9tsoWsGhrv2ouUoSqpM'</span> <span class="se">\</span>
  -H <span class="s1">'X-Product-Name: default'</span> <span class="se">\</span>
  -H <span class="s1">'X-User-Agent: CURL manual test'</span>
</code></pre>
<blockquote>
<p>Always returns an empty JSON object</p>
</blockquote>
<pre class="highlight json tab-json"><code><span class="p">{</span><span class="w">
  </span><span class="err">//</span><span class="w"> </span><span class="err">Empty</span><span class="w"> </span><span class="err">object</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>
<p><strong>POST</strong> <code class="prettyprint">/api/v3/loyalty_clubs/:loyalty_club_slug/members/by_msisdn/:msisdn/send_one_time_password</code></p>

<p>Sends a &ldquo;Login&rdquo; e-mail to given address if it is associated with member in given loyalty club. The e-mail contains a deep link to the mobile app.</p>

<p>The link scheme is: <code class="prettyprint">https://&lt;app_scheme&gt;.al.bstcm.no/lgn?member_id=&lt;member_id&gt;&amp;otp=&lt;otp&gt;</code> and contains member id and 16-digit password generated for member, valid for 1 hour.  </p>

<p>Those params then can be used to sign in the user, just as &ldquo;regular&rdquo; member password - see:  <a href="#v3-token-create">OAuth Token &bull; Create</a>.</p>

<h3 id="url-parameters">URL Parameters</h3>

<table><thead>
<tr>
<th>Parameter</th>
<th>Description</th>
<th>Type</th>
</tr>
</thead><tbody>
<tr>
<td>email</td>
<td>Member&rsquo;s email</td>
<td>e-mail</td>
</tr>
</tbody></table>

<h3 id="error-responses">Error responses</h3>

<table><thead>
<tr>
<th>Status</th>
<th>Reason</th>
</tr>
</thead><tbody>
<tr>
<td><code class="prettyprint">422</code></td>
<td>Invalid e-mail param</td>
</tr>
</tbody></table>

<aside class="notice">
Requires <code>BL:Api:Members:CreateOneTimePassword</code> permit
</aside>

<!--- ############################################################################################################# --->

<h2 id="send-registration-password"><a name="v3-members-send-registration-password"></a> Send registration password</h2>

<blockquote>
<p>Example:</p>
</blockquote>
<pre class="highlight shell tab-shell"><code>curl <span class="s2">"https://bpc-api.boostcom.no/api/v3/loyalty_clubs/infinity-mall/members/by_msisdn/4740485124/send_registration_password"</span> <span class="se">\</span>
  -H <span class="s1">'Content-Type: application/json'</span> <span class="se">\</span>
  -H <span class="s1">'X-Client-Authorization: B7t9U9tsoWsGhrv2ouUoSqpM'</span> <span class="se">\</span>
  -H <span class="s1">'X-Product-Name: default'</span> <span class="se">\</span>
  -H <span class="s1">'X-User-Agent: CURL manual test'</span>
</code></pre>
<blockquote>
<p>Always returns an empty JSON object</p>
</blockquote>
<pre class="highlight json tab-json"><code><span class="p">{</span><span class="w">
  </span><span class="err">//</span><span class="w"> </span><span class="err">Empty</span><span class="w"> </span><span class="err">object</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>
<p><strong>POST</strong> <code class="prettyprint">/api/v3/loyalty_clubs/:loyalty_club_slug/members/by_msisdn/:msisdn/send_registration_password</code></p>

<p>Sends SMS to given MSISDN.</p>

<p>The sent message contains 4-digit registration password, valid for 10 minutes.</p>

<p>This password may be required for member registration - see: <a href="#v3-members-create-registration-password">Registration password</a></p>

<h3 id="url-parameters">URL Parameters</h3>

<table><thead>
<tr>
<th>Parameter</th>
<th>Description</th>
<th>Type</th>
</tr>
</thead><tbody>
<tr>
<td>msisdn</td>
<td>MSISDN</td>
<td>string (format as defined <a href="#msisdn-member-identifier">here</a> - example: <code class="prettyprint">4740485124</code>)</td>
</tr>
</tbody></table>

<h3 id="error-responses">Error responses</h3>

<table><thead>
<tr>
<th>Status</th>
<th>Reason</th>
</tr>
</thead><tbody>
<tr>
<td><code class="prettyprint">422</code></td>
<td>Invalid MSISDN param</td>
</tr>
</tbody></table>

<aside class="notice">
Requires <code>BL:Api:Members:CreateRegistrationPassword</code> permit
</aside>

<!--- ############################################################################################################# --->

<h2 id="verify-token"><a name="v3-members-verify-token"></a> Verify token</h2>

<blockquote>
<p>Example:</p>
</blockquote>
<pre class="highlight shell tab-shell"><code>curl <span class="s2">"https://bpc-api.boostcom.no/api/v3/loyalty_clubs/infinity-mall/members/by_email/joe@example.com/verify_token/password_reset/k4wort03j2"</span> <span class="se">\</span>
  -H <span class="s1">'Content-Type: application/json'</span> <span class="se">\</span>
  -H <span class="s1">'X-Client-Authorization: B7t9U9tsoWsGhrv2ouUoSqpM'</span> <span class="se">\</span>
  -H <span class="s1">'X-Product-Name: default'</span> <span class="se">\</span>
  -H <span class="s1">'X-User-Agent: CURL manual test'</span>
</code></pre>
<blockquote>
<p>Example response:</p>
</blockquote>
<pre class="highlight json tab-json"><code><span class="p">{</span><span class="w">
  </span><span class="s2">"valid"</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>
<p><strong>GET</strong> <code class="prettyprint">/api/v3/loyalty_clubs/:loyalty_club_slug/members/by_email/:email/verify_token/:type/:token</code></p>

<p>Verifies given member token. Returns response indicating if given token is (still) valid.</p>

<h3 id="url-parameters">URL Parameters</h3>

<table><thead>
<tr>
<th>Parameter</th>
<th>Description</th>
<th>Type</th>
</tr>
</thead><tbody>
<tr>
<td>email</td>
<td>Member&rsquo;s email</td>
<td>string (email)</td>
</tr>
<tr>
<td>type</td>
<td>Token type</td>
<td><code class="prettyprint">password_reset</code> (more types in future)</td>
</tr>
<tr>
<td>token</td>
<td>Token</td>
<td>string</td>
</tr>
</tbody></table>

<h3 id="response-json-object">Response (JSON object)</h3>

<table><thead>
<tr>
<th>Key</th>
<th>Type</th>
</tr>
</thead><tbody>
<tr>
<td>valid</td>
<td>boolean</td>
</tr>
</tbody></table>

<h3 id="error-responses">Error responses</h3>

<table><thead>
<tr>
<th>Status</th>
<th>Reason</th>
</tr>
</thead><tbody>
<tr>
<td><code class="prettyprint">400</code></td>
<td>Invalid <code class="prettyprint">type</code></td>
</tr>
</tbody></table>

<aside class="notice">
Requires <code>BL:Api:Members:Tokens:Verify</code> permit
</aside>
