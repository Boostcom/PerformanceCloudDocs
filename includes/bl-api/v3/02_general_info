<h1 id="general-info">General info</h1>

<h2 id="hosts">Hosts</h2>

<p>Production: <a href="https://bpc-api.boostcom.no">https://bpc-api.boostcom.no</a></p>

<p>Staging: <a href="https://bpc-api.dev.boostcom.no">https://bpc-api.dev.boostcom.no</a></p>

<h2 id="common-http-error-codes">Common HTTP error codes</h2>

<table><thead>
<tr>
<th>Status</th>
<th>Reason</th>
</tr>
</thead><tbody>
<tr>
<td><code class="prettyprint">400</code></td>
<td>Some of required header is missing</td>
</tr>
<tr>
<td><code class="prettyprint">401</code></td>
<td><code class="prettyprint">X-Client-Authorization</code> is invalid (or doesn&rsquo;t match provided loyalty club or product)</td>
</tr>
<tr>
<td><code class="prettyprint">403</code></td>
<td>Not authorized to perform this action (provided <code class="prettyprint">X-Authorization-Token</code> doesn&rsquo;t have required permit)</td>
</tr>
<tr>
<td><code class="prettyprint">404</code></td>
<td>The requested resource doesn&rsquo;t exist</td>
</tr>
<tr>
<td><code class="prettyprint">422</code></td>
<td>Invalid parameters are provided (e.g. incorrect properties on member creation)</td>
</tr>
<tr>
<td><code class="prettyprint">460</code></td>
<td>OAuth token required for the action is invalid (applies only to OAuth-related actions - see <a href="#v3-oauth2">OAuth2</a>)</td>
</tr>
</tbody></table>

<p>Also, most of handled errors have JSON response body like this:</p>

<p><code class="prettyprint">{&quot;error&quot;: &quot;Message describing what went wrong&quot;}</code></p>

<h2 id="validation-on-members">Validation on members</h2>

<p>All members&rsquo; endpoints have properties validation. Properties are validated to conform loyalty club&rsquo;s schema.</p>

<p>If something is wrong, you will receive explanation of errors in response.</p>

<aside class="warning">
Errors format and strings are not yet stable and may change without further notice.
</aside>

<h3 id="schema-validation-errors">Schema validation errors</h3>
<pre class="highlight shell tab-shell"><code>curl -X PUT -H <span class="s2">"X-Product-Name: custom-product-name"</span> <span class="se">\</span>
    -H <span class="s2">"X-Customer-Private-Token: token"</span> <span class="se">\</span>
    -H <span class="s2">"Content-Type: application/json"</span> -d <span class="s1">'{
    "properties": {
        "first_name": "",
        "last_name": "err",
        "gender": "man",
        "birthday": "201X-01-01"
    }
}'</span> <span class="s2">"https://tbp.bstcm.no/api/v2/loyalty_clubs/:loyalty_club_slug/members/:msisdn"</span>
</code></pre>
<blockquote>
<p>Example response (with code 400):</p>
</blockquote>
<pre class="highlight json tab-json"><code><span class="p">{</span><span class="w">
  </span><span class="s2">"email"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
    </span><span class="p">{</span><span class="w">
      </span><span class="s2">"error"</span><span class="p">:</span><span class="w"> </span><span class="s2">"invalid"</span><span class="p">,</span><span class="w">
      </span><span class="s2">"property"</span><span class="p">:</span><span class="w"> </span><span class="s2">"email"</span><span class="w">
    </span><span class="p">}</span><span class="w">
  </span><span class="p">],</span><span class="w">
  </span><span class="s2">"properties"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
    </span><span class="p">{</span><span class="w">
      </span><span class="s2">"error"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="s2">"language"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
          </span><span class="p">{</span><span class="w">
            </span><span class="s2">"error"</span><span class="p">:</span><span class="w"> </span><span class="s2">"value_not_match"</span><span class="p">,</span><span class="w">
            </span><span class="s2">"value"</span><span class="p">:</span><span class="w"> </span><span class="s2">"een"</span><span class="p">,</span><span class="w">
            </span><span class="s2">"values"</span><span class="p">:</span><span class="w"> </span><span class="s2">"en, no"</span><span class="p">,</span><span class="w">
            </span><span class="s2">"property"</span><span class="p">:</span><span class="w"> </span><span class="s2">"language"</span><span class="w">
          </span><span class="p">}</span><span class="w">
        </span><span class="p">],</span><span class="w">
        </span><span class="s2">"optin_channel"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
          </span><span class="p">{</span><span class="w">
            </span><span class="s2">"error"</span><span class="p">:</span><span class="w"> </span><span class="s2">"not_contain_required_property"</span><span class="p">,</span><span class="w">
            </span><span class="s2">"property"</span><span class="p">:</span><span class="w"> </span><span class="s2">"optin_channel"</span><span class="w">
          </span><span class="p">}</span><span class="w">
        </span><span class="p">]</span><span class="w">
      </span><span class="p">}</span><span class="w">
    </span><span class="p">}</span><span class="w">
  </span><span class="p">]</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>
<table><thead>
<tr>
<th>Error</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>invalid_date_format</td>
<td>Invalid date format</td>
</tr>
<tr>
<td>invalid_time_format</td>
<td>Invalid time format</td>
</tr>
<tr>
<td>invalid_date_time_format</td>
<td>Invalid date with time format</td>
</tr>
<tr>
<td>must_be_valid_RFC3339_date_time_string</td>
<td>Format beyond the RFC3339 standard</td>
</tr>
<tr>
<td>invalid_URI</td>
<td>Invalid URI</td>
</tr>
<tr>
<td>additional_array_elements</td>
<td>Additional elements in the array</td>
</tr>
<tr>
<td>additional_properties</td>
<td>Additional properties</td>
</tr>
<tr>
<td>property_not_match_all_of</td>
<td>The property did not match all of the required schemas</td>
</tr>
<tr>
<td>property_not_match_any_of</td>
<td>The property did not match any of the required schema</td>
</tr>
<tr>
<td>property_matched_more_than_one</td>
<td>The property matched more than one of the required schemas</td>
</tr>
<tr>
<td>depends_on_a_missing_property</td>
<td>The validated property has a property that depends on the other missing property</td>
</tr>
<tr>
<td>value_not_match</td>
<td>The property value did not match one of the given values.</td>
</tr>
<tr>
<td>schema_cannot_be_found</td>
<td>The extended schema cannot be found</td>
</tr>
<tr>
<td>not_a_valid_schema</td>
<td>The property was not a valid schema</td>
</tr>
<tr>
<td>minimum_string_length</td>
<td>The property was not of a minimum string length of minimum limit.</td>
</tr>
<tr>
<td>maximum_string_length</td>
<td>The property was not of a maximum string length of maximum limit.</td>
</tr>
<tr>
<td>less_item_than_minimum</td>
<td>The property did not contain a minimum number of minimum items limit</td>
</tr>
<tr>
<td>more_item_than_maximum</td>
<td>The property had more items than the allowed items limit</td>
</tr>
<tr>
<td>less_properties_than_minimum</td>
<td>The property did not contain a minimum number of properties</td>
</tr>
<tr>
<td>more_properties_than_maximum</td>
<td>The property had more properties than allowed</td>
</tr>
<tr>
<td>not_have_value_of_exclusively</td>
<td>The property did not have value of exclusively</td>
</tr>
<tr>
<td>not_have_value_of_inclusively</td>
<td>The property did not have value of inclusively</td>
</tr>
<tr>
<td>more_decimal_places_than_maximum</td>
<td>The property had more decimal places than the allowed maximum</td>
</tr>
<tr>
<td>matched_the_disallowed_schema</td>
<td>The property matched the disallowed schema</td>
</tr>
<tr>
<td>the_regex_not_match</td>
<td>The property did not match the regex</td>
</tr>
<tr>
<td>not_contain_required_property</td>
<td>The validated property did not contain a required property</td>
</tr>
<tr>
<td>contained_undefined_properties</td>
<td>The validated property contained undefined properties</td>
</tr>
<tr>
<td>referenced_schema_cannot_be_found</td>
<td>The referenced schema cannot be found</td>
</tr>
<tr>
<td>invalid_schema</td>
<td>The property was not a valid schema</td>
</tr>
<tr>
<td>matched_one_or_more_types</td>
<td>The property matched one or more of the given types</td>
</tr>
<tr>
<td>one_or_more_types_not_match</td>
<td>The property did not match one or more of the given types</td>
</tr>
<tr>
<td>type_not_match</td>
<td>The property did not match the given type</td>
</tr>
<tr>
<td>contained_duplicated_array_values</td>
<td>The property contained duplicated array values</td>
</tr>
<tr>
<td>invalid_email</td>
<td>Invalid email format</td>
</tr>
<tr>
<td>disposable_email</td>
<td>The email was <a href="https://github.com/lisinge/valid_email2/blob/master/vendor/disposable_emails.yml">disposable</a></td>
</tr>
<tr>
<td>duplicated_email</td>
<td>The email was duplicated in community</td>
</tr>
</tbody></table>

<h2 id="member-json-model"><a name="v3-member-model"></a> Member JSON model</h2>

<blockquote>
<p>Example:</p>
</blockquote>
<pre class="highlight json tab-json"><code><span class="p">{</span><span class="w">
  </span><span class="s2">"id"</span><span class="p">:</span><span class="w"> </span><span class="mi">42</span><span class="p">,</span><span class="w">
  </span><span class="s2">"properties"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="s2">"first_name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Ola"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"last_name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Nordmann"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"birthday"</span><span class="p">:</span><span class="w"> </span><span class="s2">"1990-10-23"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"interests"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
      </span><span class="s2">"bikes_and_cars"</span><span class="p">,</span><span class="w">
      </span><span class="s2">"sportwear"</span><span class="w">
    </span><span class="p">],</span><span class="w">
    </span><span class="s2">"child_birth_years"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
      </span><span class="mi">2010</span><span class="p">,</span><span class="w">
      </span><span class="mi">2011</span><span class="p">,</span><span class="w">
      </span><span class="mi">2011</span><span class="w">
    </span><span class="p">],</span><span class="w">
    </span><span class="s2">"language"</span><span class="p">:</span><span class="w"> </span><span class="s2">"no"</span><span class="w">
  </span><span class="p">},</span><span class="w">
  </span><span class="s2">"consents"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="s2">"consent1"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="s2">"status"</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span><span class="w"> </span><span class="s2">"updated_at"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2018-12-14T21:57:20.063Z"</span><span class="w"> </span><span class="p">},</span><span class="w">
    </span><span class="s2">"consent2"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="s2">"status"</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span><span class="w"> </span><span class="s2">"updated_at"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2018-10-25T21:57:43.738Z"</span><span class="w"> </span><span class="p">}</span><span class="w">
  </span><span class="p">},</span><span class="w">
  </span><span class="s2">"sms_status"</span><span class="p">:</span><span class="w"> </span><span class="s2">"enabled"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"email_status"</span><span class="p">:</span><span class="w"> </span><span class="s2">"hard_bounced"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"push_status"</span><span class="p">:</span><span class="w"> </span><span class="s2">"disabled"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"optin_channel"</span><span class="p">:</span><span class="w"> </span><span class="s2">"webforms"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"optin_subchannel"</span><span class="p">:</span><span class="w"> </span><span class="s2">"campaign-10-2017"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"created_at"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2017-01-19T10:07:08.336+01:00"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"updated_at"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2017-04-03T09:35:19.313+02:00"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"person_id"</span><span class="p">:</span><span class="w"> </span><span class="mi">99</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>
<p>Standard member JSON model returned from many API endpoints.</p>

<table><thead>
<tr>
<th>Key</th>
<th>Description</th>
<th>Type</th>
</tr>
</thead><tbody>
<tr>
<td>id</td>
<td>Member ID</td>
<td>integer</td>
</tr>
<tr>
<td>properties</td>
<td>Object with member&rsquo;s properties</td>
<td>JSON Object</td>
</tr>
<tr>
<td>properties[&lsquo;language&rsquo;]</td>
<td>Language used by user</td>
<td>string</td>
</tr>
<tr>
<td>consents</td>
<td>Member&rsquo;s consents JSON model (see below)</td>
<td>JSON Object</td>
</tr>
<tr>
<td>sms_status</td>
<td>Status of sms channel</td>
<td>string</td>
</tr>
<tr>
<td>email_status</td>
<td>Status of email channel</td>
<td>string</td>
</tr>
<tr>
<td>push_status</td>
<td>Status of push channel</td>
<td>string</td>
</tr>
<tr>
<td>optin_channel</td>
<td>Channel (<code class="prettyprint">X-Product-Name</code> header) which had been used to register member</td>
<td>string</td>
</tr>
<tr>
<td>optin_subchannel</td>
<td>Subchannel (<code class="prettyprint">X-Subproduct-Name</code> header) which had been used to register member</td>
<td>string</td>
</tr>
<tr>
<td>created_at</td>
<td>Time when the user was firstly created</td>
<td>string</td>
</tr>
<tr>
<td>updated_at</td>
<td>Time when the user was last updated</td>
<td>string</td>
</tr>
<tr>
<td>person_id</td>
<td>Unique Member&rsquo;s identifier (set internally)</td>
<td>string</td>
</tr>
</tbody></table>

<h2 id="members-consents-json-model"><a name="v3-member-consents-model"></a> Member&rsquo;s consents JSON model</h2>

<p>JSON model for consents. Keys can be dynamically created based on customer&rsquo;s need.</p>

<p>It consists of: <code class="prettyprint">&#39;consent-slug&#39;: { &quot;status&quot;: &lt;boolean_value&gt;, &quot;updated_at&quot;: &lt;time&gt; }</code></p>

<ul>
<li>If status is <code class="prettyprint">true</code> - Member approved consent.</li>
<li>If status is <code class="prettyprint">false</code> - Member disapproved consent.</li>
<li>If you can&rsquo;t find slug on Member: he/she haven&rsquo;t disapproved or approved consent.</li>
</ul>

<p><code class="prettyprint">updated_at</code> is the time of last consent update. It can be also not provided or null.</p>

<p>Available consents for Loyalty Club are described in <a href="#v3-loyalty-clubs-schema">schema</a>.</p>
